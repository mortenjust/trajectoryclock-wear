YUI.add("hermes-template-fluid-share-panel",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){return" sharing-type-disabled"}function d(e,t){return" sharing-type-enabled"}function v(e,t){var n="",r;return n+=' title="'+l((r=(r=(r=e.networkClasses,r==null||r===!1?r:r.facebook),r==null||r===!1?r:r.canNotShareTitle),typeof r===f?r.apply(e):r))+'"',n}function m(e,t){var n="",r;return n+=' title="'+l((r=(r=(r=e.networkClasses,r==null||r===!1?r:r.tumblr),r==null||r===!1?r:r.canNotShareTitle),typeof r===f?r.apply(e):r))+'"',n}function g(e,t){var n="",r;return n+=' title="'+l((r=(r=(r=e.networkClasses,r==null||r===!1?r:r.twitter),r==null||r===!1?r:r.canNotShareTitle),typeof r===f?r.apply(e):r))+'"',n}function y(e,t){var n="",r;return n+=' title="'+l((r=(r=(r=e.networkClasses,r==null||r===!1?r:r.pinterest),r==null||r===!1?r:r.canNotShareTitle),typeof r===f?r.apply(e):r))+'"',n}function b(e,t){var n="",r;return n+=' title="'+l((r=(r=(r=e.networkClasses,r==null||r===!1?r:r.flickr),r==null||r===!1?r:r.canNotShareTitle),typeof r===f?r.apply(e):r))+'"',n}function w(e,t){return" single-link"}function E(e,t){var r="",i,s,o;r+="\n							",o={hash:{},inverse:h.noop,fn:h.program(18,S,t),data:t},s=(i=n.isFlipped||e.isFlipped,i?i.call(e,e.flippers,"enable-embedr-in-share",o):c.call(e,"isFlipped",e.flippers,"enable-embedr-in-share",o));if(s||s===0)r+=s;r+="\n							",o={hash:{},inverse:h.noop,fn:h.program(21,T,t),data:t},s=(i=n.isNotFlipped||e.isNotFlipped,i?i.call(e,e.flippers,"enable-embedr-in-share",o):c.call(e,"isNotFlipped",e.flippers,"enable-embedr-in-share",o));if(s||s===0)r+=s;r+="\n\n							",s=n["if"].call(e,(i=e.linkShareDisplay,i==null||i===!1?i:i.bbCode),{hash:{},inverse:h.noop,fn:h.program(26,k,t),data:t});if(s||s===0)r+=s;return r+="\n						",r}function S(e,t){var r="",i,s;r+="\n								",s=n["if"].call(e,(i=e.linkShareDisplay,i==null||i===!1?i:i.embedr),{hash:{},inverse:h.noop,fn:h.program(19,x,t),data:t});if(s||s===0)r+=s;return r+="\n							",r}function x(e,t){var r="",i,s;return r+='\n									<span class="link-type-button embed-type-button">',s={hash:{intlName:"share-modal.EMBED"},data:t},r+=l((i=n.intlHTMLMessage||e.intlHTMLMessage,i?i.call(e,s):c.call(e,"intlHTMLMessage",s)))+"</span>\n								",r}function T(e,t){var r="",i,s;r+="\n								",s=n["if"].call(e,(i=e.linkShareDisplay,i==null||i===!1?i:i.embedr),{hash:{},inverse:h.noop,fn:h.program(22,N,t),data:t});if(s||s===0)r+=s;r+="\n\n								",s=n["if"].call(e,(i=e.linkShareDisplay,i==null||i===!1?i:i.iframe),{hash:{},inverse:h.noop,fn:h.program(24,C,t),data:t});if(s||s===0)r+=s;return r+="\n							",r}function N(e,t){return'\n									<span class="link-type-button embed-type-button">HTML</span>\n								'}function C(e,t){return'\n									<span class="link-type-button iframe-type-button">IFRAME</span>\n								'}function k(e,t){var r="",i,s;return r+='\n								<span class="link-type-button bbcode-type-button">',s={hash:{intlName:"share-modal.BBCODE"},data:t},r+=l((i=n.intlHTMLMessage||e.intlHTMLMessage,i?i.call(e,s):c.call(e,"intlHTMLMessage",s)))+"</span>\n							",r}function L(e,t){return" single-highlight"}function A(e,t){var r="",i;r+='\n						<div class="grab-link-only grab-link">\n\n							',i=n["if"].call(e,e.canHaveGuestpass,{hash:{},inverse:h.noop,fn:h.program(31,O,t),data:t});if(i||i===0)r+=i;r+='\n\n							<input readonly type="text" class="grab-link-text-field" value="',(i=n.grabLink)?i=i.call(e,{hash:{},data:t}):(i=e.grabLink,i=typeof i===f?i.apply(e):i),r+=l(i)+'">\n\n							<div class="grab-link-loader ',i=n.unless.call(e,e.canHaveGuestpass,{hash:{},inverse:h.noop,fn:h.program(34,_,t),data:t});if(i||i===0)r+=i;r+=" ",i=n.unless.call(e,e.choiceOfPermission,{hash:{},inverse:h.noop,fn:h.program(36,D,t),data:t});if(i||i===0)r+=i;r+='"><div class="balls"></div></div>\n\n							<div class="grab-link-privacy-reminder hide-reminder',i=n["if"].call(e,e.canHaveGuestpass,{hash:{},inverse:h.noop,fn:h.program(38,P,t),data:t});if(i||i===0)r+=i;return r+='">',(i=n.privacyWarningString)?i=i.call(e,{hash:{},data:t}):(i=e.privacyWarningString,i=typeof i===f?i.apply(e):i),r+=l(i)+"</div>\n\n						</div>\n					",r}function O(e,t){var r="",i;r+="\n								",i=n["if"].call(e,e.choiceOfPermission,{hash:{},inverse:h.noop,fn:h.program(32,M,t),data:t});if(i||i===0)r+=i;return r+="\n							",r}function M(e,t){var r="",i;return r+='\n								<div class="grab-link-permission-field grab-link-field">\n									<span class="grab-link-permission-label">',(i=n.grabLinkDefaultPermission)?i=i.call(e,{hash:{},data:t}):(i=e.grabLinkDefaultPermission,i=typeof i===f?i.apply(e):i),r+=l(i)+'</span>\n									<span class="dropdown-arrow"></span>\n								</div>\n								',r}function _(e,t){return" no-permission-loader"}function D(e,t){return"no-permission-loader"}function P(e,t){return" with-guestpasses "}function H(e,t){var r="",i,s;r+='\n						<div class="sliding-frame">\n\n							<div class="link-type-content grab-link">\n\n								',i=n["if"].call(e,e.canHaveGuestpass,{hash:{},inverse:h.noop,fn:h.program(41,B,t),data:t});if(i||i===0)r+=i;r+='\n\n								<input readonly type="text" class="grab-link-text-field" value="',(i=n.grabLink)?i=i.call(e,{hash:{},data:t}):(i=e.grabLink,i=typeof i===f?i.apply(e):i),r+=l(i)+'">\n\n								<div class="grab-link-loader ',i=n.unless.call(e,e.choiceOfPermission,{hash:{},inverse:h.noop,fn:h.program(36,D,t),data:t});if(i||i===0)r+=i;r+='"><div class="balls"></div></div>\n\n								<div class="grab-link-privacy-reminder ',i=n.unless.call(e,e.canHaveGuestpass,{hash:{},inverse:h.program(38,P,t),fn:h.program(44,F,t),data:t});if(i||i===0)r+=i;r+='">',(i=n.privacyWarningString)?i=i.call(e,{hash:{},data:t}):(i=e.privacyWarningString,i=typeof i===f?i.apply(e):i),r+=l(i)+"</div>\n\n							</div>\n\n							",s=n["if"].call(e,(i=e.linkShareDisplay,i==null||i===!1?i:i.embedr),{hash:{},inverse:h.noop,fn:h.program(46,I,t),data:t});if(s||s===0)r+=s;r+="\n\n							",s=n["if"].call(e,(i=e.linkShareDisplay,i==null||
i===!1?i:i.iframe),{hash:{},inverse:h.noop,fn:h.program(48,q,t),data:t});if(s||s===0)r+=s;r+="\n\n							",s=n["if"].call(e,(i=e.linkShareDisplay,i==null||i===!1?i:i.bbCode),{hash:{},inverse:h.noop,fn:h.program(50,R,t),data:t});if(s||s===0)r+=s;return r+="\n						</div>\n\n					",r}function B(e,t){var r="",i;r+="\n									",i=n["if"].call(e,e.choiceOfPermission,{hash:{},inverse:h.noop,fn:h.program(42,j,t),data:t});if(i||i===0)r+=i;return r+="\n								",r}function j(e,t){var r="",i;return r+='\n									<div class="grab-link-permission-field grab-link-field">\n										<span class="grab-link-permission-label">',(i=n.grabLinkDefaultPermission)?i=i.call(e,{hash:{},data:t}):(i=e.grabLinkDefaultPermission,i=typeof i===f?i.apply(e):i),r+=l(i)+'</span>\n										<span class="dropdown-arrow"></span>\n									</div>\n									',r}function F(e,t){return" hide-reminder"}function I(e,t){var r="",i,s,o;return r+='\n								<div class="link-type-content html-embed">\n									<div class="embed-code-size-field embed-size-field">\n										<span class="embed-code-label">\n										',o={hash:{},data:t},r+=l((i=n.renderTrustedMarkup||e.renderTrustedMarkup,i?i.call(e,e.defaultSizeStr,o):c.call(e,"renderTrustedMarkup",e.defaultSizeStr,o)))+'\n										</span>\n										<span class="dropdown-arrow"></span>\n									</div>\n									<input readonly type="text" class="embed-code-text-field" value="',(s=n.defaultEmbedrCode)?s=s.call(e,{hash:{},data:t}):(s=e.defaultEmbedrCode,s=typeof s===f?s.apply(e):s),r+=l(s)+'">\n								</div>\n							',r}function q(e,t){var r="",i,s,o;return r+='\n								<div class="link-type-content html-iframe-embed">\n									<div class="iframe-code-size-field embed-size-field">\n										<span class="embed-code-label">\n										',o={hash:{},data:t},r+=l((i=n.renderTrustedMarkup||e.renderTrustedMarkup,i?i.call(e,e.defaultSizeStr,o):c.call(e,"renderTrustedMarkup",e.defaultSizeStr,o)))+'\n										</span>\n										<span class="dropdown-arrow"></span>\n									</div>\n									<input readonly type="text" class="iframe-code-text-field" value="',(s=n.defaultIframeCode)?s=s.call(e,{hash:{},data:t}):(s=e.defaultIframeCode,s=typeof s===f?s.apply(e):s),r+=l(s)+'">\n								</div>\n							',r}function R(e,t){var r="",i,s,o;return r+='\n								<div class="link-type-content html-bb-embed">\n									<div class="bb-code-size-field embed-size-field">\n										<span class="embed-code-label">\n											',o={hash:{},data:t},r+=l((i=n.renderTrustedMarkup||e.renderTrustedMarkup,i?i.call(e,e.defaultBBCodeSizeStr,o):c.call(e,"renderTrustedMarkup",e.defaultBBCodeSizeStr,o)))+'\n										</span>\n										<span class="dropdown-arrow"></span>\n									</div>\n									<input readonly type="text" class="bb-code-text-field" value="',(s=n.defaultBBCode)?s=s.call(e,{hash:{},data:t}):(s=e.defaultBBCode,s=typeof s===f?s.apply(e):s),r+=l(s)+'">\n								</div>\n							',r}function U(e,t){return" single-link-field"}function z(e,t){var r="",i;return r+='\n				<div class="mail-perm-field">\n					<span class="mail-permission-label">',(i=n.grabLinkDefaultPermission)?i=i.call(e,{hash:{},data:t}):(i=e.grabLinkDefaultPermission,i=typeof i===f?i.apply(e):i),r+=l(i)+'</span>\n					<span class="dropdown-arrow"></span>\n				</div>\n				',r}function W(e,t){var r="",i;r+="\n					",i=n["if"].call(e,e.nonPublicWarning,{hash:{},inverse:h.noop,fn:h.program(57,X,t),data:t});if(i||i===0)r+=i;return r+="\n				",r}function X(e,t){var r="",i,s;return r+='\n						<div class="tertiary non-public-warning">',s={hash:{},data:t},r+=l((i=n.renderTrustedMarkup||e.renderTrustedMarkup,i?i.call(e,e.nonPublicWarning,s):c.call(e,"renderTrustedMarkup",e.nonPublicWarning,s)))+"</div>\n					",r}function V(e,t){return"make-room-for-dropdown"}function $(e,t){var r;return r=n["if"].call(e,e.nonPublicWarning,{hash:{},inverse:h.noop,fn:h.program(62,J,t),data:t}),r||r===0?r:""}function J(e,t){return"make-room-for-warning"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+='<div class="share-panel-body">\n	<div class="share-panels">\n\n		<div class="main-sharing-panel share-panel">\n			<div class="network-buttons">\n				<span class="share-link '+l((o=(o=(o=t.networkClasses,o==null||o===!1?o:o.facebook),o==null||o===!1?o:o.className),typeof o===f?o.apply(t):o))+"\n\n				",u=n.unless.call(t,(o=(o=t.networkClasses,o==null||o===!1?o:o.facebook),o==null||o===!1?o:o.canShare),{hash:{},inverse:h.program(3,d,i),fn:h.program(1,p,i),data:i});if(u||u===0)s+=u;s+='"\n\n				',u=n["if"].call(t,(o=(o=t.networkClasses,o==null||o===!1?o:o.facebook),o==null||o===!1?o:o.canNotShareTitle),{hash:{},inverse:h.noop,fn:h.program(5,v,i),data:i});if(u||u===0)s+=u;s+='>\n\n					<span class="share-link-icon '+l((o=(o=(o=t.networkClasses,o==null||o===!1?o:o.facebook),o==null||o===!1?o:o.className),typeof o===f?o.apply(t):o))+'-icon"></span>\n					<span class="share-link-label">',a={hash:{intlName:"share-modal.FACEBOOK"},data:i},s+=l((o=n.intlHTMLMessage||t.intlHTMLMessage,o?o.call(t,a):c.call(t,"intlHTMLMessage",a)))+'</span>\n				</span>\n				<span class="share-link '+l((o=(o=(o=t.networkClasses,o==null||o===!1?o:o.tumblr),o==null||o===!1?o:o.className),typeof o===f?o.apply(t):o))+"\n\n				",u=n.unless.call(t,(o=(o=t.networkClasses,o==null||o===!1?o:o.tumblr),o==null||o===!1?o:o.canShare),{hash:{},inverse:h.program(3,d,i),fn:h.program(1,p,i),data:i});if(u||u===0)s+=u;s+='"\n\n				',u=n["if"].call(t,(o=(o=t.networkClasses,o==null||o===!1?o:o.tumblr),o==null||o===!1?o:o.canNotShareTitle),{hash:{},inverse:h.noop,fn:h.program(7,m,i),data:i});if(u||u===0)s+=u;s+='>\n\n					<span class="share-link-icon '+l((o=(o=(o=t.networkClasses,o==null||o===!1?o:o.tumblr),o==null||o===!1?o:o.className),typeof o===f?o.apply(t):o))+'-icon"></span>\n					<span class="share-link-label">',a={hash:{intlName:"share-modal.TUMBLR"},data:i},s+=l((o=n.intlHTMLMessage||t.intlHTMLMessage,o?o.call(t,a)
:c.call(t,"intlHTMLMessage",a)))+'</span>\n				</span>\n				<span class="share-link '+l((o=(o=(o=t.networkClasses,o==null||o===!1?o:o.twitter),o==null||o===!1?o:o.className),typeof o===f?o.apply(t):o))+"\n\n				",u=n.unless.call(t,(o=(o=t.networkClasses,o==null||o===!1?o:o.twitter),o==null||o===!1?o:o.canShare),{hash:{},inverse:h.program(3,d,i),fn:h.program(1,p,i),data:i});if(u||u===0)s+=u;s+='"\n\n				',u=n["if"].call(t,(o=(o=t.networkClasses,o==null||o===!1?o:o.twitter),o==null||o===!1?o:o.canNotShareTitle),{hash:{},inverse:h.noop,fn:h.program(9,g,i),data:i});if(u||u===0)s+=u;s+='>\n\n					<span class="share-link-icon '+l((o=(o=(o=t.networkClasses,o==null||o===!1?o:o.twitter),o==null||o===!1?o:o.className),typeof o===f?o.apply(t):o))+'-icon"></span>\n					<span class="share-link-label">',a={hash:{intlName:"share-modal.TWITTER"},data:i},s+=l((o=n.intlHTMLMessage||t.intlHTMLMessage,o?o.call(t,a):c.call(t,"intlHTMLMessage",a)))+'</span>\n				</span>\n				<span class="share-link '+l((o=(o=(o=t.networkClasses,o==null||o===!1?o:o.pinterest),o==null||o===!1?o:o.className),typeof o===f?o.apply(t):o))+"\n\n				",u=n.unless.call(t,(o=(o=t.networkClasses,o==null||o===!1?o:o.pinterest),o==null||o===!1?o:o.canShare),{hash:{},inverse:h.program(3,d,i),fn:h.program(1,p,i),data:i});if(u||u===0)s+=u;s+='"\n\n				',u=n["if"].call(t,(o=(o=t.networkClasses,o==null||o===!1?o:o.pinterest),o==null||o===!1?o:o.canNotShareTitle),{hash:{},inverse:h.noop,fn:h.program(11,y,i),data:i});if(u||u===0)s+=u;s+='>\n\n					<span class="share-link-icon '+l((o=(o=(o=t.networkClasses,o==null||o===!1?o:o.pinterest),o==null||o===!1?o:o.className),typeof o===f?o.apply(t):o))+'-icon"></span>\n					<span class="share-link-label">',a={hash:{intlName:"share-modal.PINTEREST"},data:i},s+=l((o=n.intlHTMLMessage||t.intlHTMLMessage,o?o.call(t,a):c.call(t,"intlHTMLMessage",a)))+'</span>\n				</span>\n				<span class="share-link '+l((o=(o=(o=t.networkClasses,o==null||o===!1?o:o.flickr),o==null||o===!1?o:o.className),typeof o===f?o.apply(t):o))+"\n\n				",u=n.unless.call(t,(o=(o=t.networkClasses,o==null||o===!1?o:o.flickr),o==null||o===!1?o:o.canShare),{hash:{},inverse:h.program(3,d,i),fn:h.program(1,p,i),data:i});if(u||u===0)s+=u;s+='"\n\n				',u=n["if"].call(t,(o=(o=t.networkClasses,o==null||o===!1?o:o.flickr),o==null||o===!1?o:o.canNotShareTitle),{hash:{},inverse:h.noop,fn:h.program(13,b,i),data:i});if(u||u===0)s+=u;s+='>\n\n					<span class="share-link-icon '+l((o=(o=(o=t.networkClasses,o==null||o===!1?o:o.flickr),o==null||o===!1?o:o.className),typeof o===f?o.apply(t):o))+'-icon"></span>\n					<span class="share-link-label">',a={hash:{intlName:"share-modal.MAIL"},data:i},s+=l((o=n.intlHTMLMessage||t.intlHTMLMessage,o?o.call(t,a):c.call(t,"intlHTMLMessage",a)))+'</span>\n				</span>\n			</div>\n\n			<div class="share-link-types first-stop">\n\n					<div class="link-type-buttons">\n\n						<span class="link-type-button link-grab-type-button ',u=n["if"].call(t,t.hideButtons,{hash:{},inverse:h.noop,fn:h.program(15,w,i),data:i});if(u||u===0)s+=u;s+='">',a={hash:{intlName:"share-modal.GRAB_LINK"},data:i},s+=l((o=n.intlHTMLMessage||t.intlHTMLMessage,o?o.call(t,a):c.call(t,"intlHTMLMessage",a)))+"</span>\n\n						",u=n.unless.call(t,t.hideButtons,{hash:{},inverse:h.noop,fn:h.program(17,E,i),data:i});if(u||u===0)s+=u;s+='\n\n						<span class="link-type-highlight ',u=n["if"].call(t,t.hideButtons,{hash:{},inverse:h.noop,fn:h.program(28,L,i),data:i});if(u||u===0)s+=u;s+='"></span>\n\n					</div>\n\n\n				<div class="link-type-contents">\n					',u=n["if"].call(t,t.hideButtons,{hash:{},inverse:h.program(40,H,i),fn:h.program(30,A,i),data:i});if(u||u===0)s+=u;s+='\n\n				</div>\n			</div>\n\n			<div class="link-instructions ',u=n["if"].call(t,t.moveInstructionsUp,{hash:{},inverse:h.noop,fn:h.program(52,U,i),data:i});if(u||u===0)s+=u;s+='">\n				',(u=n.copyMessage)?u=u.call(t,{hash:{},data:i}):(u=t.copyMessage,u=typeof u===f?u.apply(t):u),s+=l(u)+'\n			</div>\n			<button class="done-sharing mini">',a={hash:{intlName:"common.DONE"},data:i},s+=l((o=n.intlHTMLMessage||t.intlHTMLMessage,o?o.call(t,a):c.call(t,"intlHTMLMessage",a)))+'</button>\n		</div>\n\n\n		<div class="email-sharing-panel share-panel">\n\n			<div class="message-form">\n				<div class="fake-input">\n					<input type="text" class="email-recipient-text-field" placeholder="',a={hash:{intlName:"share-modal.SCREEN_NAME_OR_EMAIL"},data:i},s+=l((o=n.intlHTMLMessage||t.intlHTMLMessage,o?o.call(t,a):c.call(t,"intlHTMLMessage",a)))+'" data-field="recipient">\n				</div>\n\n				',u=n["if"].call(t,t.showMailPerms,{hash:{},inverse:h.program(56,W,i),fn:h.program(54,z,i),data:i});if(u||u===0)s+=u;s+='\n\n				<textarea class="email-message-text-field ',u=n["if"].call(t,t.showMailPerms,{hash:{},inverse:h.program(61,$,i),fn:h.program(59,V,i),data:i});if(u||u===0)s+=u;return s+='" placeholder="',a={hash:{intlName:"share-modal.INCLUDE_A_MESSAGE"},data:i},s+=l((o=n.intlHTMLMessage||t.intlHTMLMessage,o?o.call(t,a):c.call(t,"intlHTMLMessage",a)))+'"></textarea>\n			</div>\n\n			<button disabled class="share-by-email mini">',a={hash:{intlName:"share-modal.FLICKR_SHARE"},data:i},s+=l((o=n.intlHTMLMessage||t.intlHTMLMessage,o?o.call(t,a):c.call(t,"intlHTMLMessage",a)))+'</button>\n			<button class="leave-email-sharing mini alt">',a={hash:{intlName:"common.BACK"},data:i},s+=l((o=n.intlHTMLMessage||t.intlHTMLMessage,o?o.call(t,a):c.call(t,"intlHTMLMessage",a)))+"</button>\n\n		</div>\n\n\n	</div>\n</div>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/fluid-share-panel",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-fluid-droparound",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function c(e,t){return" html"}function h(e,t){return" subview-droparound"}function p(e,t){return" menu"}function d(e,t){return" auto-size"}function v(e,t){var r="",i;return r+="max-height: ",(i=n.staticHeight)?i=i.call(e,{hash:{},data:t}):(i=e.staticHeight,i=typeof i===u?i.apply(e):i),r+=a(i)+"px; min-height: ",(i=n.staticHeight)?i=i.call(e,{hash:{},data:t}):(i=e.staticHeight,i=typeof i===u?i.apply(e):i),r+=a(i)+"px; ",r}function m(e,t){var r="",i;return r+="width: ",(i=n.staticWidth)?i=i.call(e,{hash:{},data:t}):(i=e.staticWidth,i=typeof i===u?i.apply(e):i),r+=a(i)+"px;",r}function g(e,t){return"position: fixed;"}function y(e,t){return"hide-head"}function b(e,t){var r="",i;r+='\n			<div class="content text-only',i=n["if"].call(e,e.autoSizeToContent,{hash:{},inverse:f.noop,fn:f.program(7,d,t),data:t});if(i||i===0)r+=i;return r+='">\n				',(i=n.textMessage)?i=i.call(e,{hash:{},data:t}):(i=e.textMessage,i=typeof i===u?i.apply(e):i),r+=a(i)+"\n			</div>\n		",r}function w(e,t){var r="",i,s;r+='\n			<div class="content html-only',i=n["if"].call(e,e.autoSizeToContent,{hash:{},inverse:f.noop,fn:f.program(7,d,t),data:t});if(i||i===0)r+=i;return r+='">\n				',s={hash:{},data:t},r+=a((i=n.renderTrustedMarkup||e.renderTrustedMarkup,i?i.call(e,e.htmlMessage,s):l.call(e,"renderTrustedMarkup",e.htmlMessage,s)))+"\n			</div>\n		",r}function E(e,t){return'\n			<div class="content subview"></div>\n		'}function S(e,t){var r="",i;r+='\n			<div class="content menu">\n				<ul role="menu">\n					',i=n.each.call(e,e.menuItems,{hash:{},inverse:f.noop,fn:f.program(24,x,t),data:t});if(i||i===0)r+=i;return r+="\n				</ul>\n			</div>\n		",r}function x(e,t){var r="",i;r+='\n					<li role="menuitem">',i=n["if"].call(e,e.href,{hash:{},inverse:f.noop,fn:f.program(25,T,t),data:t});if(i||i===0)r+=i;(i=n.text)?i=i.call(e,{hash:{},data:t}):(i=e.text,i=typeof i===u?i.apply(e):i),r+=a(i),i=n["if"].call(e,e.href,{hash:{},inverse:f.noop,fn:f.program(28,C,t),data:t});if(i||i===0)r+=i;return r+="</li>\n					",r}function T(e,t){var r="",i;r+='<a href="',(i=n.href)?i=i.call(e,{hash:{},data:t}):(i=e.href,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',i=n["if"].call(e,e.className,{hash:{},inverse:f.noop,fn:f.program(26,N,t),data:t});if(i||i===0)r+=i;return r+=">",r}function N(e,t){var r="",i;return r+=' class="',(i=n.className)?i=i.call(e,{hash:{},data:t}):(i=e.className,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function C(e,t){return"</a>"}function k(e,t){return"hide-foot"}function L(e,t){return'\n		<div class="droparrow up"></div>\n	'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this,l=n.helperMissing;s+='<div class="droparound',o=n["if"].call(t,t.htmlMessage,{hash:{},inverse:f.noop,fn:f.program(1,c,i),data:i});if(o||o===0)s+=o;o=n["if"].call(t,t.subview,{hash:{},inverse:f.noop,fn:f.program(3,h,i),data:i});if(o||o===0)s+=o;o=n["if"].call(t,t.menuItems,{hash:{},inverse:f.noop,fn:f.program(5,p,i),data:i});if(o||o===0)s+=o;o=n["if"].call(t,t.autoSizeToContent,{hash:{},inverse:f.noop,fn:f.program(7,d,i),data:i});if(o||o===0)s+=o;s+=" ",(o=n.classList)?o=o.call(t,{hash:{},data:i}):(o=t.classList,o=typeof o===u?o.apply(t):o),s+=a(o)+'"\nstyle="',o=n["if"].call(t,t.staticHeight,{hash:{},inverse:f.noop,fn:f.program(9,v,i),data:i});if(o||o===0)s+=o;s+="\n",o=n["if"].call(t,t.staticWidth,{hash:{},inverse:f.noop,fn:f.program(11,m,i),data:i});if(o||o===0)s+=o;s+="\n",o=n["if"].call(t,t.positionFixed,{hash:{},inverse:f.noop,fn:f.program(13,g,i),data:i});if(o||o===0)s+=o;s+='">\n	<div class="head ',o=n.unless.call(t,t.headContent,{hash:{},inverse:f.noop,fn:f.program(15,y,i),data:i});if(o||o===0)s+=o;s+='">\n		',(o=n.headContent)?o=o.call(t,{hash:{},data:i}):(o=t.headContent,o=typeof o===u?o.apply(t):o),s+=a(o)+'\n	</div>\n	<div class="body">\n		',o=n["if"].call(t,t.textMessage,{hash:{},inverse:f.noop,fn:f.program(17,b,i),data:i});if(o||o===0)s+=o;s+="\n		",o=n["if"].call(t,t.htmlMessage,{hash:{},inverse:f.noop,fn:f.program(19,w,i),data:i});if(o||o===0)s+=o;s+="\n		",o=n["if"].call(t,t.subview,{hash:{},inverse:f.noop,fn:f.program(21,E,i),data:i});if(o||o===0)s+=o;s+="\n		",o=n["if"].call(t,t.menuItems,{hash:{},inverse:f.noop,fn:f.program(23,S,i),data:i});if(o||o===0)s+=o;s+='\n	</div>\n	<div class="foot ',o=n.unless.call(t,t.footContent,{hash:{},inverse:f.noop,fn:f.program(30,k,i),data:i});if(o||o===0)s+=o;s+='">\n		',(o=n.footContent)?o=o.call(t,{hash:{},data:i}):(o=t.footContent,o=typeof o===u?o.apply(t):o),s+=a(o)+"\n	</div>\n	",o=n["if"].call(t,t.showDropArrow,{hash:{},inverse:f.noop,fn:f.program(32,L,i),data:i});if(o||o===0)s+=o;return s+="\n</div>\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/fluid-droparound",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("fluid-droparound-view",function(e){"use strict";var t,n;t={css:{destinationContainer:"body",subviewContent:".content.subview",menuContent:".content.menu",droparoundContainer:".droparound",droparoundContent:".body .content",droparrow:".droparrow"},options:{}},n={supportsTransform:!1,droparound:{height:0,width:0}},e.namespace("Views").FluidDroparound=e.FlickrView.create(this.name,e.FlickrView,[],{initializer:function(e){this.set("isActiveViewAgnostic",!0)},buildContainer:function(){return!this.get("textMessage")&&!this.get("htmlMessage")&&!this.get("subview")&&!this.get("menuItems")?(this.appContext.warn("FluidDroparoundView requires a `textMessage`, `htmlMessage`, `subview`, or `menuItems`."),this):(this.get("menuItems")&&this.set("menuItems",this.get("menuItems").filter(function(e){return!e.hidden})),this.setContainerHTML(this.templates("fluid-droparound")({textMessage:this.get("textMessage"),htmlMessage:this.get("message")?this.get("message"):this.get("htmlMessage"),subview:!!this.get("subview"),menuItems:this.get("menuItems"),showDropArrow:this.get("showDropArrow"),hideModalOverlay:this.get("hideModalOverlay"),hideDroparoundOverlay:this.get("hideDroparoundOverlay"),classList:this.get("classList"),footContent:this.get("footContent"),headContent:this.get("headContent"),staticWidth:this.get("width"),staticHeight:this.get("height"),positionFixed:this.get("positionFixed"),autoSizeToContent:this.get("autoSizeToContent")})),this.appendAndPosition(),this)},activate:function(){var n=this.get("container"),r=this;return e.OverlayManager.DroparoundOverlay.add(this),this.registerEventHandler(e.on("droparound:reposition",e.bind(this.anchorPositionChange,this))),this.registerEventHandler(e.on("history:change",function(e){if(e.src==="popstate"&&e.prevVal&&e.newVal)if(e.prevVal.flickr&&e.prevVal.flickr.referrer||e.newVal.flickr&&e.newVal.flickr.referrer)return;r.close(e)})),this.get("subview")&&this.loadSubview(),this.get("menuItems")&&this.registerEventHandler(n.one(t.css.menuContent).delegate("click",this.onMenuItemClick.bind(this),"li")),this.get("observePageResize")&&this.observePageResize(),this.get("closeOnScroll")&&this.observePageScroll(),this.fire("activated"),this},loadSubview:function(){var n,r,i=!1,s=this.get("subview"),o=this;n=this.get("container").one(t.css.subviewContent),n.appendChild(e.Node.create(this.templates("flickr-balls")({})).addClass("flickr-balls")),r=setTimeout(function(){i=!0},40),this.loading=!0,s.appContext=o.appContext,s.set("isActiveViewAgnostic",!0),s.initialize().then(function(e){clearTimeout(r),i&&(e.get("container").addClass("load-transition"),setTimeout(function(){e.get("container").removeClass("load-transition")},1)),o.onSubviewInitialized(e)})},onSubviewInitialized:function(n){var r=this,i=this.get("container").one(t.css.subviewContent);if(!this.loading)return;this.loading=!1,i.one(".flickr-balls").remove(!0),i.appendChild(n.get("container")),n.on("subviewViewEvent",function(e){e&&e.details&&e.details.length&&r.fire.apply(r,e.details)}),n.normalizedActivate(),n.recursivelyActivateSubviews(),r.appendAndPosition(),r.registerEventHandler(r.get("subview").on("actionClick",e.bind(r.handleAction,r)))},onMenuItemClick:function(e){var n,r;n=e.target.ancestor("li",!0),n&&(r=this.get("container").one(t.css.menuContent).all("li").indexOf(n),r!==-1&&this.fire("selected",{menuItemIndex:r,menuItem:this.get("menuItems")[r]}))},appendAndPosition:function(){var r=e.one(t.css.destinationContainer),i=this.get("container").one(t.css.droparoundContainer);r&&(r.append(this.get("container")),n.droparound.width=this.get("width")||i.getComputedStyle("width"),n.droparound.height=this.get("height")||i.getComputedStyle("height"),this.repositionToElement(this.get("anchorElement")))},updateTextMessage:function(e){e&&e!==""&&(this.set("textMessage",e),this.buildContainer())},updateHTMLMessage:function(e){e&&e!==""&&(this.set("htmlMessage",e),this.buildContainer())},anchorPositionChange:function(){this.repositionToElement(this.get("anchorElement"))},observePageResize:function(){var t=this;this.registerEventHandler(e.globalEvents.subscribe("window:resize",function(n){e.fire("droparound:reposition"),t.get("closeOnResize")&&t.handleClose(n)}))},observePageScroll:function(){var t=YUI.Env.isServer?0:e.config.win.pageYOffset,n=this;this.get("startingScrollPoint")||this.set("startingScrollPoint",t),this.registerEventHandler(e.globalEvents.subscribe("window:scroll",n.handleScroll.bind(n)))},handleScroll:function(t){var n,r=this.get("startingScrollPoint");r?(n=e.config.win.pageYOffset,r+this.get("closeOnScrollDistance")<n&&this.handleClose(t)):this.set("startingScrollPoint",e.config.win.pageYOffset)},repositionToElement:function(r){var i=this.get("container"),s=e.one("body"),o=i.one(".droparound"),u=o.one(t.css.droparrow),a=r.getXY(),f=this.get("mirrorArrowAdjustment"),l=s.get("offsetWidth"),c=this.get("showDropArrow"),h=this.get("anchorOffsetVertical"),p=this.get("anchorOffsetHorizontal"),d=this.get("anchorPositionOffset"),v=this.get("minVerticalSpace"),m=o.get("offsetHeight"),g=o.get("offsetWidth"),y=parseInt(r.getComputedStyle("width"),10)||r.get("offsetWidth"),b=parseInt(r.getComputedStyle("height"),10)||r.get("offsetHeight"),w=this.get("dropdownArrowWidth"),E=this.get("dropdownArrowHeight"),S=n.droparound.width?parseInt(n.droparound.width,10):parseInt(o.getComputedStyle("width"),10),x=n.droparound.height?parseInt(n.droparound.height,10):parseInt(o.getComputedStyle("height"),10),T=o.one(t.css.droparoundContent),N=this.get("minHorizontalSpace")+Math.max(m,x),C=l-Math.max(g,S)-d-N,k=r.getDOMNode().getBoundingClientRect(),L,A,O,M,_,D,P,H,B,j=this.get("preferLeft"),F=this.get("preferTop"),I=this.get("preferBottom"),q=0,R=this.appContext.viewportData.getHeight();y||(y=0),b||(b=0),L=Math.ceil((y-w)/2),M=S||g,_=x||m,A=a[1]-x-h,this.get("horizCenterToAnchor")?(O=a[0]+y/2-M/2,q=M/2-w/2):(O=a[0]-p,q=L+f+p),this.get("preferredSide")?this.get("preferredSide")==="left-middle"?(A=a[1]+Math.round(y/2)-h,O=
a[0]+y+L+f+p+E,u.removeClass("down").addClass("left").setStyles({left:L+f-Math.round(E/2)+"px",top:(_-E)/2+"px"})):this.get("preferredSide")==="bottom-middle"&&(A=a[1]+Math.round(y/2)-h,O=a[0]+y+L+f+p+E,u.removeClass("down").addClass("up").setStyles({left:(M-w)/2-L+f-Math.round(w/2)+"px",top:_+"px"})):(P=A<v||k.top-x-h<v,H=O>C,B=k.top+k.height+x+h>R,!F&&P||F&&!P||I&&!B?(A=a[1]+b+h,c&&u.removeClass("up").addClass("down").setStyle("left",q+"px")):c&&u.removeClass("down").addClass("up").setStyle("left",q+"px"),this.get("forceLeft")||!j&&H||j&&!H?a[0]+y+p>l?(O=a[0]-S,c&&u.addClass("right").setStyle("left","auto").setStyle("right",L+y+"px")):(O=a[0]-S+y+p,c&&u.addClass("right").setStyle("left","auto").setStyle("right",L+p+"px")):c&&u.removeClass("right").setStyle("right","auto").setStyle("left",q+"px")),o.setXY([O,A]),!this.get("menuItems")&&!this.get("autoSizeToContent")&&(D={width:M+"px",height:_+"px"},T.setStyles(D))},handleClose:function(e){this.close()},handleAction:function(e){this.fire("actionClick",e),this.get("dismissOnActionClick")&&this.close(e)},show:function(){var e=!this.isActivated,t=this;return this.initialize().then(function(){t.isClosed=!1,e||t.activate()}),this},close:function(){var t=this.get("container");this.loading=!1,this.isClosed=!0,this.fire("closeDroparound"),this.destroy(),this.get("subview")&&this.get("subview").destroy(),t&&t.remove(!0),e.OverlayManager.DroparoundOverlay.remove(this)},destructor:function(){this.detachAll()}},{ATTRS:{dismissOnOverlayClick:{value:!0,validator:function(t,n){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,n){return e.AttributeHelpers.coerceBoolean(t)}},dismissOnActionClick:{value:!0,validator:function(t,n){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,n){return e.AttributeHelpers.coerceBoolean(t)}},hideModalOverlay:{value:!0,validator:function(t,n){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,n){return e.AttributeHelpers.coerceBoolean(t)}},invisibleOverlay:{value:!1,validator:function(t,n){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,n){return e.AttributeHelpers.coerceBoolean(t)}},preferredSide:{value:null},message:{value:null},textMessage:{value:null},htmlMessage:{value:null},footContent:{value:null},headContent:{value:null},width:{value:0,validator:function(t,n){return e.AttributeHelpers.validateInteger(t)},setter:function(t,n){return e.AttributeHelpers.coerceInteger(t)}},height:{value:0,validator:function(t,n){return e.AttributeHelpers.validateInteger(t)},setter:function(t,n){return e.AttributeHelpers.coerceInteger(t)}},subview:{value:null},menuItems:{value:null},classList:{value:"",validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t,n){return e.AttributeHelpers.coerceString(t)}},anchorElement:{value:null},showDropArrow:{value:!1,validator:function(t,n){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,n){return e.AttributeHelpers.coerceBoolean(t)}},anchorOffsetVertical:{value:15,validator:function(t,n){return e.AttributeHelpers.validateInteger(t)},setter:function(t,n){return e.AttributeHelpers.coerceInteger(t)}},anchorOffsetHorizontal:{value:5,validator:function(t,n){return e.AttributeHelpers.validateInteger(t)},setter:function(t,n){return e.AttributeHelpers.coerceInteger(t)}},contentPadding:{value:12,validator:function(t,n){return e.AttributeHelpers.validateInteger(t)},setter:function(t,n){return e.AttributeHelpers.coerceInteger(t)}},minVerticalSpace:{value:60,validator:function(t,n){return e.AttributeHelpers.validateInteger(t)},setter:function(t,n){return e.AttributeHelpers.coerceInteger(t)}},minHorizontalSpace:{value:60,validator:function(t,n){return e.AttributeHelpers.validateInteger(t)},setter:function(t,n){return e.AttributeHelpers.coerceInteger(t)}},dropdownArrowWidth:{value:21,validator:function(t,n){return e.AttributeHelpers.validateInteger(t)},setter:function(t,n){return e.AttributeHelpers.coerceInteger(t)}},dropdownArrowHeight:{value:11},anchorPositionOffset:{value:15,validator:function(t,n){return e.AttributeHelpers.validateInteger(t)},setter:function(t,n){return e.AttributeHelpers.coerceInteger(t)}},observePageResize:{value:!0,validator:function(t,n){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,n){return e.AttributeHelpers.coerceBoolean(t)}},preferLeft:{value:!1,validator:function(t,n){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,n){return e.AttributeHelpers.coerceBoolean(t)}},preferTop:{value:!1,validator:function(t,n){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,n){return e.AttributeHelpers.coerceBoolean(t)}},preferBottom:{value:!1,validator:function(t,n){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,n){return e.AttributeHelpers.coerceBoolean(t)}},mirrorArrowAdjustment:{value:0,validator:function(t,n){return e.AttributeHelpers.validateInteger(t)},setter:function(t,n){return e.AttributeHelpers.coerceInteger(t)}},positionFixed:{value:!1,validator:function(t,n){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,n){return e.AttributeHelpers.coerceBoolean(t)}},closeOnScroll:{value:!1,validator:function(t,n){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,n){return e.AttributeHelpers.coerceBoolean(t)}},closeOnScrollDistance:{value:40,validator:function(t,n){return e.AttributeHelpers.validateInteger(t)},setter:function(t,n){return e.AttributeHelpers.coerceInteger(t)}},closeOnResize:{value:!1,validator:function(t,n){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,n){return e.AttributeHelpers.coerceBoolean(t)}},overlayClassList:{value:"",validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t,n){return e.AttributeHelpers.coerceString(t)}},forceLeft:{value:null},autoSizeToContent:{value:!1,validator:function(t,n){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,n){return e.AttributeHelpers.coerceBoolean(t)}},horizCenterToAnchor:{value:!1,validator
:function(t,n){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,n){return e.AttributeHelpers.coerceBoolean(t)}}}})},"@VERSION@",{requires:["flickr-view","fluid-css","hermes-template-fluid-droparound","fluid-balls-css","hermes-template-flickr-balls","fluid-overlay-manager-view","attribute-helpers"],optionalRequires:["fluid"]});
YUI.add("hermes-template-fluid-share-embedr-code",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<a data-flickr-embed="true" href="',(o=n.embedLink)?o=o.call(t,{hash:{},data:i}):(o=t.embedLink,o=typeof o===u?o.apply(t):o),s+=a(o)+'" title="',(o=n.title)?o=o.call(t,{hash:{},data:i}):(o=t.title,o=typeof o===u?o.apply(t):o),s+=a(o)+'"><img src="',(o=n.farmURL)?o=o.call(t,{hash:{},data:i}):(o=t.farmURL,o=typeof o===u?o.apply(t):o),s+=a(o)+'" width="',(o=n.width)?o=o.call(t,{hash:{},data:i}):(o=t.width,o=typeof o===u?o.apply(t):o),s+=a(o)+'" height="',(o=n.height)?o=o.call(t,{hash:{},data:i}):(o=t.height,o=typeof o===u?o.apply(t):o),s+=a(o)+'" alt="',(o=n.alt)?o=o.call(t,{hash:{},data:i}):(o=t.alt,o=typeof o===u?o.apply(t):o),s+=a(o)+'"></a><script async src="//widgets.flickr.com/embedr/embedr.js" charset="utf-8"></script>',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/fluid-share-embedr-code",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-fluid-share-bb-code",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function h(e,t){var r="",i;r+="by [url=",i=n["if"].call(e,e.authorURL,{hash:{},inverse:l.program(4,d,t),fn:l.program(2,p,t),data:t});if(i||i===0)r+=i;return r+="]",(i=n.authorName)?i=i.call(e,{hash:{},data:t}):(i=e.authorName,i=typeof i===a?i.apply(e):i),r+=f(i)+"[/url]",r}function p(e,t){var r;return(r=n.authorURL)?r=r.call(e,{hash:{},data:t}):(r=e.authorURL,r=typeof r===a?r.apply(e):r),f(r)}function d(e,t){return"shortURL"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=this,c=n.helperMissing;s+="[url=",(o=n.shortURL)?o=o.call(t,{hash:{},data:i}):(o=t.shortURL,o=typeof o===a?o.apply(t):o),s+=f(o)+"][img]",(o=n.farmURL)?o=o.call(t,{hash:{},data:i}):(o=t.farmURL,o=typeof o===a?o.apply(t):o),s+=f(o)+"[/img][/url][url=",(o=n.shortURL)?o=o.call(t,{hash:{},data:i}):(o=t.shortURL,o=typeof o===a?o.apply(t):o),s+=f(o)+"]",(o=n.title)?o=o.call(t,{hash:{},data:i}):(o=t.title,o=typeof o===a?o.apply(t):o),s+=f(o)+"[/url] ",o=n["if"].call(t,t.authorName,{hash:{},inverse:l.noop,fn:l.program(1,h,i),data:i});if(o||o===0)s+=o;return s+=", ",u={hash:{intlName:"share-modal.ON_FLICKR"},data:i},s+=f((o=n.intlMessage||t.intlMessage,o?o.call(t,u):c.call(t,"intlMessage",u))),s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/fluid-share-bb-code",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-share-modal-mail-pill",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div class="pill" title="',(o=n.value)?o=o.call(t,{hash:{},data:i}):(o=t.value,o=typeof o===u?o.apply(t):o),s+=a(o)+'">\n	<span>',(o=n.value)?o=o.call(t,{hash:{},data:i}):(o=t.value,o=typeof o===u?o.apply(t):o),s+=a(o)+'</span>\n	<span class="remove-tag">\n		<i class="delete-tag" title="Delete"></i>\n	</span>\n</div>',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/share-modal-mail-pill",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-fluid-warning",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function h(e,t){var r;return(r=n.title)?r=r.call(e,{hash:{},data:t}):(r=e.title,r=typeof r===a?r.apply(e):r),f(r)}function p(e,t){var r,i;return i={hash:{intlName:"common.OOPS"},data:t},f((r=n.intlMessage||e.intlMessage,r?r.call(e,i):l.call(e,"intlMessage",i)))}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing,c=this;s+='<div class="fluid-warning">\n	<span class="warning-title">',o=n["if"].call(t,t.title,{hash:{},inverse:c.program(3,p,i),fn:c.program(1,h,i),data:i});if(o||o===0)s+=o;return s+='</span>\n	<br/><br/>\n	<span class="warning-message">',(o=n.message)?o=o.call(t,{hash:{},data:i}):(o=t.message,o=typeof o===a?o.apply(t):o),s+=f(o)+'</span>\n	<button class="button">',u={hash:{intlName:"common.OK"},data:i},s+=f((o=n.intlMessage||t.intlMessage,o?o.call(t,u):l.call(t,"intlMessage",u)))+"</button>\n</div>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/fluid-warning",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-fluid-share-panel-error",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='<div class="share-panel-body cancel-share">\n	<div class="cancel-message">\n		',(o=n.errorMessage)?o=o.call(t,{hash:{},data:i}):(o=t.errorMessage,o=typeof o===a?o.apply(t):o),s+=f(o)+'\n	</div>\n\n	<button class="done-sharing mini">',u={hash:{intlName:"common.CANCEL"},data:i},s+=f((o=n.intlHTMLMessage||t.intlHTMLMessage,o?o.call(t,u):l.call(t,"intlHTMLMessage",u)))+"</button>\n</div>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/fluid-share-panel-error",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-fluid-share-old-html-embed-code",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing;return s+='<a href="',(o=n.embedLink)?o=o.call(t,{hash:{},data:i}):(o=t.embedLink,o=typeof o===f?o.apply(t):o),s+=l(o)+'" title="',(o=n.title)?o=o.call(t,{hash:{},data:i}):(o=t.title,o=typeof o===f?o.apply(t):o),s+=l(o)+" by ",(o=n.authorName)?o=o.call(t,{hash:{},data:i}):(o=t.authorName,o=typeof o===f?o.apply(t):o),s+=l(o)+", ",a={hash:{intlName:"share-modal.ON_FLICKR"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+'"><img src="',(u=n.farmURL)?u=u.call(t,{hash:{},data:i}):(u=t.farmURL,u=typeof u===f?u.apply(t):u),s+=l(u)+'" width="',(u=n.width)?u=u.call(t,{hash:{},data:i}):(u=t.width,u=typeof u===f?u.apply(t):u),s+=l(u)+'" height="',(u=n.height)?u=u.call(t,{hash:{},data:i}):(u=t.height,u=typeof u===f?u.apply(t):u),s+=l(u)+'" alt="',(u=n.alt)?u=u.call(t,{hash:{},data:i}):(u=t.alt,u=typeof u===f?u.apply(t):u),s+=l(u)+'"></a>',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/fluid-share-old-html-embed-code",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-fluid-share-old-iframe-embed-code",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<iframe src="',(o=n.embedLink)?o=o.call(t,{hash:{},data:i}):(o=t.embedLink,o=typeof o===u?o.apply(t):o),s+=a(o)+'" width="',(o=n.width)?o=o.call(t,{hash:{},data:i}):(o=t.width,o=typeof o===u?o.apply(t):o),s+=a(o)+'" height="',(o=n.height)?o=o.call(t,{hash:{},data:i}):(o=t.height,o=typeof o===u?o.apply(t):o),s+=a(o)+'" frameborder="0" allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/fluid-share-old-iframe-embed-code",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("flickr-contacts-getListfetcher",function(e,t){"use strict";function n(t,n){var r=t[0],i=t[1];return r.contacts&&r.contacts.contact&&r.contacts.contact.forEach(function(t){i.exists(t.nsid)||i.add(e.APIHelper.response.parsePerson(t))}),r}function r(n,r){var i=this;return n.extras=(n.extras||"")+", icon_urls, paid_products",e.Promise.all([r.callAPI("flickr.contacts.getList",n),r.getModelRegistry("person-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-contacts-getList"]={run:r,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["person-models"]});
YUI.add("contact-search-box",function(e){var t,n=function(n){this.options=n,this.options.elValue=this.options.elValue||"value",this.options.hideInitially||[],this._contacts=null,this.queryEl=this.options.el,this.queryElEvent,this.listEl=null,t=this.options.DOMContainer||e.config.win,this.init()};n.prototype={langBundles:["common","photo-page-scrappy"],init:function(){var t=this;this.options.showFollowingState!==!1&&(this.options.showFollowingState=!0),this.queryEl.on("keydown",this.keynav.bind(this)),this.queryElEvent=this.queryEl.on("keyup",this.search.bind(this)),this.wrapperEl=e.Node.create("<div/>"),this.wrapperEl.addClass("c-contact-search-autocomplete"),this.listEl=e.Node.create("<ul/>"),this.listEl.addClass("contact-list"),this.wrapperEl.appendChild(this.listEl),this.listEl.on("mouseover",function(e){var n=e.target.ancestor("li",!0);if(!n||n===t.highlighted)return;t._highlight(n)}),this.queryEl.ancestor().insertBefore(this.wrapperEl,this.queryEl),this.wrapperEl.appendChild(this.queryEl),this.options.clickContact=this.options.clickContact||function(e){var n=e.target.ancestor("[data-nsid]",!0),r=n?n.getData("nsid"):"";t.select(r)},this.listEl.delegate("click",this.options.clickContact,"li"),this.selectedIndex=0},keynav:function(e){e.keyCode===38?(e.preventDefault(),this.selectedIndex--,this.selectedIndex<0&&(this.selectedIndex=this.numShowing+this.selectedIndex),this._highlight(this.selectedIndex),this._scrollToNode(this.highlighted)):e.keyCode===40?(e.preventDefault(),this.selectedIndex++,this.selectedIndex>this.numShowing-1&&(this.selectedIndex=this.numShowing-this.selectedIndex),this._highlight(this.selectedIndex),this._scrollToNode(this.highlighted)):e.keyCode===9?this._visible&&this.highlighted&&(e.preventDefault(),this.select(this.highlighted.getData("nsid"))):e.keyCode===13&&this._visible&&this.highlighted&&(e.preventDefault(),!e.target.ancestor(".share-view",!0)&&!e.target.ancestor(".fluid-share-panel-view",!0)?this.options.clickContact(e,this.highlighted):this.select(this.highlighted.getData("nsid")))},_highlight:function(t){var n=this.listEl.all("li"),r=t instanceof e.Node,i=r?t:n.item(t),s=r?n.indexOf(t):t;i&&!i.hasClass("loading")&&!i.hasClass("no-members")&&(n.removeClass("highlight"),i.addClass("highlight"),this.selectedIndex=s,this.highlighted=i)},_scrollToNode:function(e){var t=this.listEl.get("scrollTop"),n=t+this.listEl.get("clientHeight"),r=e.get("offsetTop"),i=r+e.get("clientHeight"),s=5;t>r?this.listEl.set("scrollTop",r-s):n<i&&this.listEl.set("scrollTop",i-this.listEl.get("clientHeight")+s)},getContact:function(e){var t=0,n=this._contacts,r=n.length;for(;t<r;t++)if(n[t].nsid===e&&!n[t].hide)return n[t]},hideFromSearch:function(e){e=e.trim(),this._contacts&&this._contacts.some(function(t){if(t.nsid.trim()===e)return t.hide=!0,!0})},resetSearch:function(){this._contacts&&this._contacts.forEach(function(e){e.hide=!1})},showInSearch:function(e){e=e.trim(),this._contacts&&this._contacts.some(function(t){if(t.nsid.trim()===e)return t.hide=!1,!0})},load:function(e){var t={},n=this,r,i;if(this._busy)return;return this._end=!1,this._busy=!0,t.can_tag=this.options.canTag||0,i=this.options.appContext.getViewer().nsid,r=this.options.appContext.getModel("contacts-models",i),r.then(function(r){return t.page=1,t.perPage=3e3,t.per_page=3e3,n._loadMoreContacts(r,t,e)},function(){n._busy=!1,n.options.onError()})},_loadMoreContacts:function(e,t,n){var r=this;return this._busy=!0,r.options.loadingState&&!r.listEl.one("li.loading")&&r.appendLoader(),e.getValue("contacts").getPage(t).then(function(i){r.options.appContext.flipper.isFlipped("search-outside-contacts")||(r._busy=!1),r._contacts=(r.processContactModels(i,!0,!0)||[]).concat(r._contacts||[]),n(),(!r._contacts||r._contacts.length===0)&&r.hide(),t.page<e.getValue("pages")&&(t.page++,r._loadMoreContacts(e,t,n))},function(){r._busy=!1,r.options.onError()})},processContactModels:function(t,n,r){var i=this,s,o,u;try{u=t.map(function(e){return e.toJSON()})||[]}catch(a){u=[]}if(!i.contactIds){i.contactIds={};if(i._contacts)for(o in i._contacts)i.contactIds[o.id]=!0}return u=u.filter(function(e){return!i.contactIds[e.id]}),u.forEach(function(t,n){i.contactIds[t.id]=!0,t.realname=t.realname||t.username,t.isContact=r,t.buddyicon=e.URLHelper.getBuddyIconURL(t.nsid,t.iconfarm,t.iconserver)}),n&&i.options.me&&(s=i.options.me.toJSON(),e.APIHelper.response.agnosticizeFarmPathTransferProtocol(s.buddyicon),s.buddyicon=s.buddyicon["default"],i.contactIds[s.id]=!0,s.me=!0,u.push(s)),i.options.hideInitially&&u.forEach(function(e){i.options.hideInitially.indexOf(e.nsid)>-1&&(e.hide=!0)}),u},destructor:function(){this.queryElEvent&&this.queryElEvent.detach&&this.queryElEvent.detach()},hide:function(e){e&&e.halt();if(!this._visible)return;this._visible=!1,this.highlighted=null,this.selectedIndex=0,this.selected=null,this.options.noShim||this._shimUp(!1),this.listEl.setStyle("display","none"),this.options.onHide&&this.options.onHide()},show:function(){if(this._visible)return;this._visible=!0,this.options.noShim||this._shimUp(),this.listEl.setStyle("display","block"),this._reposition(),this.options.onShow()},_reposition:function(){var n={width:t.innerWidth||t.clientWidth,height:t.innerHeight||t.clientHeight},r=this.options.el,i=r.getDOMNode(),s=i.getBoundingClientRect(),o=this.listEl.getDOMNode().getBoundingClientRect(),u=!this._contacts,a=u&&this.options.upInitially,f=t===e.config.win?s.top:i.clientTop,l;this.options.dialogOffset&&(l=this.options.dialogOffset()),a||f>0&&f+o.height+25>n.height&&!this.options.alwaysDownward?(this.listEl.setStyle("top","auto"),this.listEl.setStyle("bottom","25px"),this.options.onOrientationChange&&this.options.onOrientationChange(!0)):(this.listEl.setStyle("top",l||null),this.listEl.setStyle("bottom",null),this.options.onOrientationChange&&this.options.onOrientationChange(!1),r.ancestor(".modal",!0)&&this.listEl.setStyle("maxHeight",n.height-f-25))},_shimUp:function(t){if(t===!1){if(!this._shim)return;this._shim.detach
("click").remove(),this._shim=null;return}this._shim=e.Node.create("<div/>"),this._shim.addClass(this.options.shim),this._shim.on("click",this.hide.bind(this)),this.wrapperEl.appendChild(this._shim)},select:function(e){typeof e=="string"&&(e=this.getContact(e),this.queryEl.set("value",e.realname)),this.selected=e,this.options.onSelect(e),this.hide()},search:function(e){var t=this.queryEl.get(this.options.elValue),n=this,r,i,s,o=this.options.appContext.getViewer().nsid;if(e&&e.keyCode===27){e.preventDefault(),this.queryEl.blur();return}if(e&&[38,40,9].indexOf(e.keyCode)!==-1){e.preventDefault();return}this._nameTest(t),this.selected=null,this.selectedIndex=0,this.abort=!1;if(t.trim()==="")return this.abort=!0,this.hide();this.options.searchNonContacts||(this._end=!0,this._busy=!1);if(this._contacts&&this.options.me&&t==="me")return this.showResults(this._contacts.filter(function(e){return!e.hide&&e.me}).concat(this._contacts.filter(function(e){return!e.hide&&n._matchesQuery(e)})));if(this._isEmail(t))return this.select({email:t,nsid:null});if(/,/.test(t))return this.select(null);if(!this._contacts){if(this.options.signedOut)return;this.showResults(),this.load(this.search.bind(this))}this._contacts&&(r=this._contacts.filter(function(e){return!e.hide&&n._matchesQuery(e)})),this.showResults(r),i=n.listEl.getDOMNode(),this.options.searchNonContacts&&(this.options.loadMoreOnScroll&&n.options.appContext.flipper.isFlipped("search-outside-contacts")&&t.length>0?(s=1,clearTimeout(this.searchAllPeople),this.searchInstanceId=Math.random()*999999,this.searchAllPeople=setTimeout(function(){n._searchPeople(t,o,s,n.searchInstanceId,function(){n._busy=!1,n.showResults(n._contacts.filter(function(e){return!e.hide&&n._matchesQuery(e)})),n.listElScrollEvent=n.listEl.on("scroll",function(){n.listEl._node.clientHeight+n.listEl._node.scrollTop===n.listEl._node.scrollHeight&&(s++,n._loadMore(s,o,t))})})},500)):(clearTimeout(this.searchAllPeople),this.searchInstanceId=Math.random()*999999))},_loadMore:function(e,t,n){var r=this;this._busy=!0,clearTimeout(this.searchAllPeople),this.searchInstanceId=Math.random()*999999,this.searchAllPeople=setTimeout(function(){r.options.loadingState&&!r.listEl.one("li.loading")&&r.appendLoader(),r._searchPeople(n,t,e,r.searchInstanceId,function(){r.showResults(r._contacts.filter(function(e){return!e.hide&&r._matchesQuery(e)})),r.listElScrollEvent&&r.listElScrollEvent.detach(),r.listElScrollEvent=r.listEl.on("scroll",function(){r.listEl._node.clientHeight+r.listEl._node.scrollTop===r.listEl._node.scrollHeight&&(e++,r._loadMore(e,t,n))})})},100)},_nameTest:function(t){var n=new RegExp(".*"+e.flutil.agnosticizeUnicode(t).replace(/\s/,"\\s")+".*","ig");this._matchesQuery=function(e){return n.test(e.username)||n.test(e.realname)||n.test(e.email)}},appendLoader:function(e){e=e||this.listEl;var t=document.createElement("li"),n=e.scrollTop;t.className="loading",t.innerHTML=this.options.loadingState,e.appendChild(t),e.scrollTop=n+t.clientHeight},_searchPeople:function(e,t,n,r,i){var s=this,o,u;s._end=!1,s.options.loadingState&&!s.listEl.one("li.loading")&&s.appendLoader(),o=s.options.appContext.getModel("contacts-models",t),o.then(function(t){return u=t.search({username:e,page:n}),u.then(function(e){var t=e.people,n=s.processContactModels(t,!1,!1);s._contacts=s._contacts||[],s._contacts=s._contacts.concat(n),s._contacts.some(function(e){return s._matchesQuery(e)})||(s._end=!0),i()},function(){s._end=!0,s._busy=!1,i()})},function(){s._end=!0,s._busy=!1,i()})},_isEmail:function(e,t){/,/.test(e)?e=e.split(/,/):e=[e];var n=/^\s*[\w\-\+_]+(\.[\w\-\+_]+)*\@[\w\-\+_]+\.[\w\-\+_]+(\.[\w\-\+_]+)*\s*$/;if(t){while(e.length)if(n.test(e.shift().trim()))return!0;return!1}while(e.length)if(!n.test(e.shift().trim()))return!1;return!0},showResults:function(t){if(this.abort)return;var n=this.options.max||10,r,i,s=this;r=document.createDocumentFragment(),t&&this.selectedIndex>=t.length&&(this.selectedIndex=t.length-1),this.numShowing=Math.min(n,t&&t.length||0),!s._busy&&t&&t.length===0?(i=document.createElement("li"),i.innerHTML='<span class="no-contacts">'+this.intlMessage({intlName:"photo-page-scrappy.NO_MEMBERS_FOUND"})+"</span>",i.className="no-members",r.appendChild(i),s.highlighted=null):t&&t.slice(0,n).forEach(function(t,n,i){var o=s.createItem(t);n===s.selectedIndex&&(o.setAttribute("class","highlight"),s.highlighted=e.Node(o)),r.appendChild(o)}),(s._busy||!t)&&s.options.loadingState&&s.appendLoader(r),this.options.loadMoreOnScroll&&this.listElScrollEvent&&this.listElScrollEvent.detach(),this.listEl.setHTML(""),this.listEl.getDOMNode().appendChild(r),this.show()},_template:function(){return['<img src="{{buddyicon}}">','<div class="following-status {{isContact}}">','<span class="following-icon">&nbsp;</span>',"<span>"+this.intlMessage({intlName:"common.FOLLOWING"})+"</span>","</div>",'<h2 class="all">{{realname}}</h2>','<h3 class="all">{{username}}</h3>'].join("")},_onlyContactTemplate:['<img src="{{buddyicon}}">',"<h2>{{realname}}</h2>","<h3>{{username}}</h3>"].join(""),createItem:function(t){var n=document.createElement("li"),r,i=this.options.searchNonContacts&&this.options.showFollowingState?this._template():this._onlyContactTemplate,s=this.options.truncateLength||70;return r=i.replace(/\{\{(\w+)\}\}/g,function(n,r){if(r==="buddyicon")return t[r];if(r==="isContact")return t[r]?"am-following":"";var i=e.flutil.escapeInput(t[r]);return e.Handlebars.helpers.truncate(i,s)}),n.innerHTML=r,n.dataset?(n.dataset=n.dataset,n.dataset.nsid=t.nsid,n.dataset.displayname=t.realname||t.username,n.dataset.pathAlias=t.pathAlias):(n.setAttribute("data-nsid",t.nsid),n.setAttribute("data-displayname",t.realname||t.username),n.setAttribute("data-path-alias",t.pathAlias)),n}},e.mix(n.prototype,e.Localizable),e.ContactSearchBox=n},"@VERSION@",{requires:["api-helper","flutil","contact-search-css","handlebars-helpers","flickr-contacts-getListfetcher"],langBundles:["common","photo-page-scrappy"]});
YUI.add("fluid-share-panel-view",function(e){var t=".dropdown-arrow",n="embed-code-size-field",r="iframe-code-size-field",i="bb-code-size-field",s={},o=50,u=["sq","t","q","s","n","m","z","c","b","l","h","k"];s[n]="embed-code-text-field",s[r]="iframe-code-text-field",s[i]="bb-code-text-field",e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.networkClasses=e.networkClasses||{},this.linkShareParams=e.linkShareParams,this.guestPassParams=e.guestPassParams||{},this.emailShareParams=e.emailShareParams,this.signedOutSharingPerms=e.signedOutSharingPerms||{},this.shareItemCount=e.shareItemCount||1,this.PERMISSIONS=[],this.guestPassParams.canSharePrivate&&this.PERMISSIONS.push({text:this.intlMessage({intlName:"share-modal.SHARE_PRIVATE"}),value:"private"}),this.guestPassParams.shareNonPublic!==!1&&(this.guestPassParams.contentMarkedFriendFamily&&this.PERMISSIONS.push({text:this.intlMessage({intlName:"share-modal.SHARE_FAMILY_AND_FRIENDS"}),value:"family_and_friends"}),this.guestPassParams.contentMarkedFamily&&this.PERMISSIONS.push({text:this.intlMessage({intlName:"share-modal.SHARE_FAMILY"}),value:"family"}),this.guestPassParams.contentMarkedFriends&&this.PERMISSIONS.push({text:this.intlMessage({intlName:"share-modal.SHARE_FRIENDS"}),value:"friends"})),this.guestPassParams.contentMarkedPublic&&this.PERMISSIONS.push({text:this.intlMessage({intlName:"share-modal.SHARE_PUBLIC_ONLY"}),value:"public"}),this.isMine=e.isMine||!1,this.cancel=!1,this.guestPasses={},this.flickrShare={recipients:[],guestpassStr:this.PERMISSIONS[0]?this.PERMISSIONS[0].value:"private"},this},loadState:function(){var t=[],n=this;this.appContext.getViewer().nsid&&t.push(this.appContext.getModel("person-models",this.appContext.getViewer().nsid).then(function(e){n.set("me",e)}));if(this.guestPassParams.shareToAll)Object.keys(this.signedOutSharingPerms).forEach(function(e){n.networkClasses[e].canShare=!0});else if(this.guestPassParams.shareToSpecific)Object.keys(this.guestPassParams.shareToSpecific).forEach(function(e){n.networkClasses[e].canShare=n.guestPassParams.shareToSpecific[e].canShare,n.networkClasses[e].canNotShareTitle=n.guestPassParams.shareToSpecific[e].canNotShareTitle});else{var r={};r[this.emailShareParams.modelName+"_id"]=this.emailShareParams.modelId,this.emailShareParams.modelOwnerId&&(r.owner_id=this.emailShareParams.modelOwnerId),t.push(this._loadSharingPermissionsFromAPI(r))}return e.Promise.all(t)},_loadSharingPermissionsFromAPI:function(t){var n=this;return t.breakCache=(new Date).toISOString(),this.appContext.callAPI("flickr.sharing.canShare",t).then(function(e){e&&e.services&&e.services.service&&e.services.service.forEach(function(e){Object.keys(n.networkClasses).some(function(t){if(n.networkClasses[t].serviceId===e.serviceTypeId){n.networkClasses[t].canShare=!!e.canShare,e.canShare||(n.networkClasses[t].canNotShareTitle=e.reason.map(function(e){return e.content}).join(", "));if(e.serviceTypeId===130&&e.reason&&e.reason.length&&e.reason.some(function(e){return e.code===3}))return n.cancelMessage=n.intlMessage({intlName:"share-modal.CANCEL_SHARE_BECAUSE_RESTRICTED"}),n.cancel=!0,!0;if(e.serviceTypeId===130){n.PERMISSIONS.length&&n.PERMISSIONS[n.PERMISSIONS.length-1].value!=="public"&&(n.guestpassRequired=!0);if(e.availableGuestpasses){e.guestpassRequired===1&&n.PERMISSIONS.length&&n.PERMISSIONS[n.PERMISSIONS.length-1].value==="public"&&n.PERMISSIONS.shift(),e.guestpassRequired===1&&(n.guestpassRequired=!0,n.guestPassParams=n.guestPassParams||{},n.guestPassParams.contentMarkedPublic=!1,n.guestPassParams.nonPublicWarning=!0);var r=!1,i=!1,s=!1;e.availableGuestpasses.guestpass.forEach(function(e){e.content==="friends"&&(r=!0),e.content==="family"&&(i=!0),e.content==="private"&&(s=!0)});var o=0;while(o<n.PERMISSIONS.length)n.PERMISSIONS[o].value==="friends"&&!r||n.PERMISSIONS[o].value==="family"&&!i||n.PERMISSIONS[o].value==="family_and_friends"&&!i&&!r||n.PERMISSIONS[o].value==="private"&&!s?n.PERMISSIONS.splice(o,1):o++}else n.PERMISSIONS.length&&n.PERMISSIONS[n.PERMISSIONS.length-1].value==="public"&&(n.PERMISSIONS=[n.PERMISSIONS[0]]);n.flickrShare.guestpassStr=n.PERMISSIONS[0]?n.PERMISSIONS[0].value:"private"}return!0}return!1})})},function(t){e.Flog.error("[fluid-share-panel-view] Error reading canShare permissions:",t),Object.keys(n.signedOutSharingPerms).forEach(function(e){n.networkClasses[e].canShare=n.signedOutSharingPerms[e].canShare})})},buildContainer:function(){var t,n,r=this.guestPassParams.showGuestPassDropdown&&this.isMine&&!!this.guestPassParams.type||!this.guestPassParams.contentMarkedPublic,i="";if(this.cancel)return t=this.templates("fluid-share-panel-error")({errorMessage:this.cancelMessage||this.intlMessage({intlName:"share-modal.CANCEL_SHARE_BECAUSE_ERROR",photoCount:this.guestPassParams.multipleItems?2:1})}),this.setContainerHTML(t),this;this.linkShareDisplay=this.generateLinkSharingDisplay(this.linkShareParams),e.UA.os==="macintosh"?i=this.intlMessage({intlName:"share-modal.COPY_MAC"}):i=this.intlMessage({intlName:"share-modal.COPY_PC"}),n={networkClasses:this.networkClasses,linkShareDisplay:this.linkShareDisplay,privacyWarningString:this.linkShareParams.privacyWarningString,shareItemCount:this.shareItemCount,grabLink:this.guestPassParams.contentMarkedPublic||this.linkShareParams.generateLink?this.linkShareParams.shortURL:null,canHaveGuestpass:r,emailShareParams:this.emailShareParams,showMailPerms:this.guestPassParams.showGuestPassDropdown&&this.isMine&&this.guestPassParams.multipleItems&&this.PERMISSIONS.length>0,nonPublicWarning:this.guestPassParams.nonPublicWarning,grabLinkDefaultPermission:(r&&this.PERMISSIONS.length)>0?this.PERMISSIONS[0].text:"",copyMessage:i,choiceOfPermission:this.PERMISSIONS.length>1};if(this.linkShareDisplay.embedr){var s=0;this.linkShareDisplay.embedr.sizes.forEach(function(e,t){var n=u.indexOf(e.sizeKey);n>s&&(s=t)}),n.defaultSizeStr=this.linkShareDisplay.embedr.sizes[s].sizeStr,n.defaultEmbedrCode=
this.linkShareDisplay.embedr.sizes[s].embedCode}if(this.linkShareDisplay.bbCode){var o=0;this.linkShareDisplay.bbCode.sizes.forEach(function(e,t){var n=u.indexOf(e.sizeKey);n>o&&(o=t)}),n.defaultBBCode=this.linkShareDisplay.bbCode.sizes[o].embedCode,n.defaultBBCodeSizeStr=this.linkShareDisplay.bbCode.sizes[o].sizeStr}if(this.linkShareDisplay.iframe){var a=0;this.linkShareDisplay.iframe.sizes.forEach(function(e,t){var n=u.indexOf(e.sizeKey);n>a&&(a=t)}),n.defaultSizeStr=this.linkShareDisplay.iframe.sizes[a].sizeStr,n.defaultIframeCode=this.linkShareDisplay.iframe.sizes[a].embedCode}return!this.linkShareDisplay.bbCode&&!this.linkShareDisplay.embedr&&!this.linkShareDisplay.iframe&&(n.hideButtons=!0),n.moveInstructionsUp=n.hideButtons&&!n.canHaveGuestpass&&!n.choiceOfPermission,t=this.templates("fluid-share-panel")(n),this.setContainerHTML(t),this},activate:function(){var t=this.get("container"),n=this;this.registerEventHandler(t.delegate("click",function(e){e.preventDefault(),n.fire("subviewViewEvent","done-sharing")},".done-sharing")),this.guestpassRequired&&this.fire("subviewViewEvent","guestpass-required");if(this.cancel)return this;this.dropdowns={},this.linkShareDisplay||(this.linkShareDisplay=this.generateLinkSharingDisplay(this.linkShareParams)),this.registerEventHandler(t.delegate("click",function(e){e.preventDefault(),n._toggleLinkSelection(e,t)},".link-type-button")),this.registerEventHandler(t.delegate("click",function(e){e.preventDefault(),n._createdDropdownForEmbedIframeBB.bind(n)(e,t)},".embed-size-field")),this.registerEventHandler(t.delegate("click",function(e){e.preventDefault(),n._createGrabLinkPermissionDropdown(e,t)},".grab-link-field")),this.registerEventHandler(t.delegate("click",function(e){e.preventDefault(),n._createMailPermissionDropdown(e,t)},".mail-perm-field")),this.registerEventHandler(t.delegate("click",function(e){e.target.select()},".bb-code-text-field, .grab-link-text-field, .embed-code-text-field")),this.registerEventHandler(t.delegate("click",function(e){n.appContext.getViewer().signedIn?e.target.ancestor("."+n.networkClasses.flickr.className,!0)&&(e.preventDefault(),t.one(".share-panels").addClass("show-email-form")):n.fire("subviewViewEvent","confirm-sign-out")},".share-link.sharing-type-enabled")),this.registerEventHandler(t.one(".leave-email-sharing").on("click",function(e){e.preventDefault(),t.one(".share-panels").removeClass("show-email-form")})),this.registerEventHandler(t.one(".share-by-email").on("click",function(e){e.preventDefault(),n._onShareByEmail(e)})),this.setupEmailSharing();var r=this.PERMISSIONS[0].value;if(!this.linkShareParams.generateLink&&r!=="public"){t.one(".grab-link-privacy-reminder").removeClass("hide-reminder");var i=[1,1,1];r==="friends"?i=[0,1,0]:r==="family"?i=[1,0,0]:r==="family_and_friends"&&(i=[1,1,0]),this.requestGuestpass.apply(this,i)}this.linkShareParams.generateLink&&(t.one(".grab-link-privacy-reminder").removeClass("hide-reminder"),this.generatingLink||(this.generatingLink=!0,this.startGuestpassLoader(),this.fire("subviewViewEvent","generate-link")));var s=e.OverflowHelper.detectScrollbarSize(e.one("body"));t.one(".message-form")&&t.one(".message-form").setStyle("paddingRight",s+"px"),t.one(".share-by-email")&&t.one(".share-by-email").setStyle("marginRight",s+"px"),t.one(".share-panel-body")&&t.one(".share-panel-body").setStyle("paddingRight",s+"px"),this.setHighlightWidths();if(!this.linkShareParams.generateLink){var o=t.one(".grab-link-text-field");o&&o.select()}return this},onParentViewEvent:function(e,t){var n=this.get("container"),r=n.one(".grab-link-text-field");if(t[0]==="flickr-share-error")this._onWarning(this.intlMessage({intlName:"share-modal.FLICKR_SHARE_ERROR"}));else if(t[0]==="flickr-share-success"){var i=n.one(".fake-input");i.removeClass("not-empty"),i.all(".pill").remove(),n.one(".email-message-text-field").set("value",""),n.one(".email-recipient-text-field").setStyle("width","inherit"),n.one(".share-by-email").set("disabled",!0),this.contacts.resetSearch(),this.to={},this.flickrShare.recipients=[],this._onWarning(this.intlMessage({intlName:"share-modal.FLICKR_SHARE_SUCCESS"}),this.intlMessage({intlName:"share-modal.FLICKR_SHARE_SUCCESS_TITLE"}),!0)}else t[0]==="guestpass-created"?(this.guestPasses[""+t[1]]=t[2],r.set("value",t[2]),r.select(),this.endGuestpassLoader()):t[0]==="guestpass-failed"?(n.one(".grab-link-permission-label")&&n.one(".grab-link-permission-label").set("text",this.intlMessage({intlName:"share-modal.SHARE_PUBLIC_ONLY"})),r.set("value",this.linkShareParams.shortURL),this.endGuestpassLoader(),this._onWarning(this.intlMessage({intlName:"share-modal.GUESTPASS_CREATION_FAILURE"}))):t[0]==="generated-link"&&(n.one(".grab-link-text-field").set("text",t[1]),r.set("value",t[1]),r.select(),this.endGuestpassLoader())},setHighlightWidths:function(){var t=this.get("container"),n=t.one(".link-type-highlight"),r=20,i=0,s=11,o,u="grabLinkItem",a=e.StorageHelper.getItem("fluid-share-panel-first-selected")||u,f,l,c;o=[{name:u,element:t.one(".link-grab-type-button")},{name:"embedItem",element:t.one(".embed-type-button")},{name:"iframeItem",element:t.one(".iframe-type-button")},{name:"bbCodeItem",element:t.one(".bbcode-type-button")}],this.highlightWidths={};for(c=0;c<o.length;c++){l=o[c];if(!l.element)continue;i=parseInt(l.element.get("clientWidth"),10),this.highlightWidths[l.name]={width:i,left:s+"px"},s+=i+r,l.name===a&&(f=l.element)}Object.keys(this.highlightWidths).length===1&&(a=u),n.setStyles(this.highlightWidths[a]),a!==u&&this._toggleLinkSelection({target:f},t)},_toggleLinkSelection:function(t,n){var r=n.one(".link-type-highlight"),i,s=t.target.ancestor(".link-type-buttons",!0).get("children").indexOf(t.target);n.one(".share-link-types").toggleClass("first-stop",s===0).toggleClass("second-stop",s===1).toggleClass("third-stop",s===2).toggleClass("fourth-stop",s===3),t.target.hasClass("link-grab-type-button")?(i=this.highlightWidths.grabLinkItem,n.one(".grab-link-text-field").select(),e.StorageHelper
.setItem("fluid-share-panel-first-selected","grabLinkItem")):t.target.hasClass("embed-type-button")?(i=this.highlightWidths.embedItem,n.one(".embed-code-text-field").select(),e.StorageHelper.setItem("fluid-share-panel-first-selected","embedItem")):t.target.hasClass("iframe-type-button")?(i=this.highlightWidths.iframeItem,n.one(".iframe-code-text-field").select(),e.StorageHelper.setItem("fluid-share-panel-first-selected","iframeItem")):t.target.hasClass("bbcode-type-button")&&(i=this.highlightWidths.bbCodeItem,n.one(".bb-code-text-field").select(),e.StorageHelper.setItem("fluid-share-panel-first-selected","bbCodeItem")),r.setStyles(i)},_createDropdown:function(n,r,i,s,o){var u=this;if(!o||o.isClosed)o=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,hideModalOverlay:!0,classList:"over-modal",overlayClassList:"over-modal",anchorElement:n.one("."+r+" "+t),observePageResize:!0,menuItems:i,forceLeft:!0,anchorOffsetHorizontal:10,closeOnResize:!0,preferBottom:!0}),o.on("selected",function(e){o.close(),s.bind(u)(e)}),o.show()},_createdDropdownForEmbedIframeBB:function(e,t){var o,a,f,l;e.target.ancestor(".embed-size-field",!0).hasClass(n)?(o=n,a="embedr"):e.target.ancestor(".embed-size-field",!0).hasClass(r)?(o=r,a="iframe"):e.target.ancestor(".embed-size-field",!0).hasClass(i)&&(o=i,a="bbCode"),f=this.linkShareDisplay[a].sizes,l=u.concat(["o"]),this._createDropdown(t,o,Object.keys(f).map(function(e){return{text:f[e].sizeStr,value:f[e].sizeKey}}).sort(function(e,t){return l.indexOf(e.value)<l.indexOf(t.value)?-1:1}),function(e){e&&e.menuItem&&f.some(function(n){return n.sizeKey===e.menuItem.value?(t.one("."+s[o]).set("value",n.embedCode),t.one("."+o).one(".embed-code-label").set("text",n.sizeStr),!0):!1})},this.dropdowns[a])},_createGrabLinkPermissionDropdown:function(e,t){var n=this;this._createDropdown(t,"grab-link-field",this.PERMISSIONS,function(e){if(e&&e.menuItem){var r=e.menuItem.value,i=t.one(".grab-link-text-field"),s=t.one(".grab-link-privacy-reminder");t.one(".grab-link-permission-label").set("text",e.menuItem.text);if(r==="public")i.set("value",n.linkShareParams.shortURL),s.addClass("hide-reminder");else{var o=0,u=0,a=0;r==="friends"?o=1:r==="family"&&(u=1),r==="family_and_friends"?(u=1,o=1):r==="private"&&(a=1),s.removeClass("hide-reminder"),n.requestGuestpass(u,o,a)}}},this.dropdowns.grabLink)},_createMailPermissionDropdown:function(e,t){var n=this;this._createDropdown(t,"mail-perm-field",this.PERMISSIONS,function(e){e&&e.menuItem&&(t.one(".mail-permission-label").set("text",e.menuItem.text),n.flickrShare.guestpassStr=e.menuItem.value)},this.dropdowns.mail)},_onShareByEmail:function(e){this.fire("subviewViewEvent","share-by-email",{recipients:this.flickrShare.recipients,guestpassStr:this.flickrShare.guestpassStr,message:this.get("container").one(".email-message-text-field").get("value")})},generateLinkSharingDisplay:function(t){var n=this,r={link:t.url},i=t.sizes?Object.keys(t.sizes):[];return i.length>0&&t.supportsEmbedr&&(n.appContext.flipper.isFlipped("enable-embedr-in-share")?r.embedr={sizes:Object.keys(t.sizes).map(function(r){return{sizeKey:r,sizeStr:n.getSizeStr(r)+" "+t.sizes[r].width+" \u00d7 "+t.sizes[r].height,embedCode:n.templates("fluid-share-embedr-code")({embedLink:e.url(t.url),title:t.title,farmURL:e.URLHelper.addProtocolToURL(t.sizes[r].url),width:t.sizes[r].width,height:t.sizes[r].height,alt:t.title})}})}:(r.embedr={sizes:Object.keys(t.sizes).map(function(r){return{sizeKey:r,sizeStr:n.getSizeStr(r)+" "+t.sizes[r].width+" \u00d7 "+t.sizes[r].height,embedCode:n.templates("fluid-share-old-html-embed-code")({embedLink:e.url(t.url),title:t.title,authorName:t.author,farmURL:e.URLHelper.addProtocolToURL(t.sizes[r].url),width:t.sizes[r].width,height:t.sizes[r].height,alt:t.title})}})},r.iframe={sizes:Object.keys(t.sizes).map(function(r){var i;return i=e.config.win.location.href,i[i.length-1]!=="/"&&(i+="/"),i+="player/",{sizeKey:r,sizeStr:n.getSizeStr(r)+" "+t.sizes[r].width+" \u00d7 "+t.sizes[r].height,embedCode:n.templates("fluid-share-old-iframe-embed-code")({embedLink:i,title:t.title,farmURL:e.URLHelper.addProtocolToURL(t.sizes[r].url),width:t.sizes[r].width,height:t.sizes[r].height,alt:t.title})}})})),i.length>0&&t.supportsBBCode&&(r.bbCode={sizes:Object.keys(t.sizes).map(function(r){return{sizeKey:r,sizeStr:n.getSizeStr(r)+" "+t.sizes[r].width+" \u00d7 "+t.sizes[r].height,embedCode:n.templates("fluid-share-bb-code")({title:t.title,farmURL:e.URLHelper.addProtocolToURL(t.sizes[r].url),shortURL:t.shortURL,authorURL:e.url(t.authorURL),authorName:t.author})}})}),r},getSizeStr:function(e){var t="";return"sq,q".indexOf(e)>-1?t=this.intlMessage({intlName:"common.SQUARE"}):e==="t"?t=this.intlMessage({intlName:"common.THUMBNAIL"}):"s,n".indexOf(e)>-1?t=this.intlMessage({intlName:"common.SMALL"}):"m,z,c".indexOf(e)>-1?t=this.intlMessage({intlName:"common.MEDIUM"}):"l,h,k".indexOf(e)>-1?t=this.intlMessage({intlName:"common.LARGE"}):e==="o"&&(t=this.intlMessage({intlName:"common.ORIGINAL"})),t},requestGuestpass:function(e,t,n){var r=this.get("container").one(".grab-link-text-field"),i=""+e+t+n;if(this.guestPasses[i]){r.set("value",this.guestPasses[i]);return}var s={is_private:n,is_family:e,is_friend:t},o=this.guestPassParams.type,u=this.guestPassParams.id;o==="photo"&&(s.photo=u),o==="photostream"&&(s.photostream=u),o==="set"&&(s.set=u),this.startGuestpassLoader(),this.fire("subviewViewEvent","request-guestpass",i,s)},startGuestpassLoader:function(){var e=this;setTimeout(function(){if(!e.guestpassLoaded){var t=e.get("container").one(".grab-link-loader");t.setStyle("display","block"),t.addClass("show-loader")}},o)},endGuestpassLoader:function(){var e=this.get("container").one(".grab-link-loader");this.guestpassLoaded=!0,e.removeClass("show-loader"),setTimeout(function(){this.guestpassLoaded&&e.setStyle("display","none")}.bind(this),500)},setupEmailSharing:function(){var t=this.get("container"),n=t.one(".email-recipient-text-field"),r=this.fakeInput=t.one(".fake-input"
),i=this.input=this.get("container").one('[data-field="recipient"]'),s=t.one(".email-message-text-field"),o=t.one(".share-by-email"),u=this;this.focus&&(setTimeout(function(){n.focus()},100),this.focus=!1),n&&(this.to={},this.arrow=e.Node.create('<span class="ui-dialog-arrow contact-autocomplete-arrow"></span>'),n.on("focus",function(){r.addClass("focus"),i.get("value")===""?u.contacts.hide():u.contacts.search(),u._adjustInputWidth()}),n.on("blur",function(){i.ancestor(".fake-input").one(".pill")||t.one(".email-recipient-text-field").setStyle("width","inherit")}),i.on("blur",function(){var e,t=!1;e=u.contacts.selected,e&&e.email&&(t=!0,u._makePill(e,t),u.contacts.selected=null,u.get("container").one(".fake-input").insertBefore(i,u.contacts.wrapperEl)),r.removeClass("focus")}),i.on("keydown",function(e){var t,n,r;if(e.keyCode===8)this.get("value")===""&&(n=u.get("container").all(".pill"),r=n.pop(),r&&r.fire("remove")),setTimeout(function(){u._adjustInputWidth()},0);else if(e.keyCode===13||e.keyCode===9&&!e.shiftKey||e.keyCode===32||e.keyCode===188)t=u.contacts.selected,t&&t.email?(e.preventDefault(),u._makePill(t),u.contacts.selected=null,u._arrangeInput()):e.keyCode===13&&!u.contacts.selected&&(e.preventDefault(),this.get("value")===""&&u.get("container").one('[data-field="message"]').focus())}),i.on("keypress",function(e){var t=this.get("value");u._adjustInputWidth(t+String.fromCharCode(e.which)),u.contacts._reposition(),this.show()}),i.on("keyup",function(e){e.keyCode===8&&this.get("value")===""&&u._arrangeInput()}),s.on("keydown",function(e){e.keyCode===9&&!e.shiftKey&&(e.preventDefault(),o.focus())}),s.on("keyup",function(t){var n=s.get("value").trim()==="",r=e.Object.size(u.to)===0&&u.input.get("value")==="";n||r?o.setAttribute("disabled",!0):o.removeAttribute("disabled")}),r.delegate("click",function(e){u._arrangeInput()},".fake-input"),r.delegate("mouseover",function(e){var t=e.currentTarget,n=r.get("clientWidth"),i=t.get("offsetLeft"),s=parseInt(t.getComputedStyle("width").replace("px",""),10);n-i-s-10>0?(t.addClass("not-eol"),t.removeClass("end-of-the-line")):(t.removeClass("not-eol"),t.addClass("end-of-the-line"))},".pill"),this.contacts=new e.ContactSearchBox({el:n,appContext:this.appContext,shim:"c-contact-search-shim",signedOut:!this.appContext.getViewer().signedIn,alwaysDownward:!0,DOMContainer:t.one(".share-panel-body").getDOMNode(),loadingState:this.templates(e.Balls())(),onError:function(){n.blur(),u.contacts.hide()},onShow:function(e){var t=u.get("container"),n=u.get("container").one(".contact-list");t.on("click",function(e){e.target.get("tagName")!=="INPUT"&&n.getStyle("display")==="block"&&u.contacts.hide()})},onSelect:function(e,t){e&&e.nsid&&(u._makePill(e),u._arrangeInput())},dialogOffset:function(){var e=u.fakeInput.getDOMNode().getBoundingClientRect(),t=u.input.getDOMNode().getBoundingClientRect();return e.height-t.height+10}}))},_adjustInputWidth:function(t){var n,r,i,s=this.get("container"),o=s.one(".share-by-email"),u=this;return t=t||this.input.get("value"),e.Object.size(this.to)===0&&t===""?(r=s.one(".fake-input"),r.removeClass("not-empty"),n=r.get("clientWidth"),s.one(".email-message-text-field").get("value").trim()!==""&&o.setAttribute("disabled",!0),this.input.setStyle("width",n-20),setTimeout(function(){u.input.focus()},10),n):(i=e.Node.create('<span class="width-check"></span>'),i.set("innerHTML",t),this.get("container").appendChild(i),n=i.get("clientWidth")||0,i.remove(),this.input.setStyle("width",(n||30)+5+"px"),setTimeout(function(){u.input.focus()},10),n)},_makePill:function(e,t){var n=e.realname||e.email,r=this.templates("share-modal-mail-pill")({value:n}),i,s=this.get("container"),o=s.one(".share-by-email"),u=s.one(".fake-input"),a=this;u.addClass("not-empty"),s.one(".email-message-text-field").get("value").trim()!==""&&o.removeAttribute("disabled"),this.to[n]=e,a.completeSameEvent&&a.completeSameEvent.detach(),i=u.insertBefore(r,this.contacts.wrapperEl),i.on("remove",function(t){e.nsid?a.contacts.showInSearch(e.nsid):e.email&&!t&&(a.input.set("value",i.one("span:first-child").get("innerHTML")),a._adjustInputWidth()),delete a.to[n],i.remove(),a.flickrShare.recipients.some(function(t,n){return t.nsid&&t.nsid===e.nsid||!t.nsid&&t.name&&t.name===e.name?(a.flickrShare.recipients.splice(n,1),!0):!1})}),i.delegate("click",function(e){e.stopPropagation(),i.fire("remove",!0),a.input.focus()},".remove-tag"),i.on("dblclick",function(t){t.stopPropagation();var r=a.input;r.set("value",n),a._adjustInputWidth(n),i.replace(r),i.fire("remove"),setTimeout(function(){r.focus()},10),a.contacts.search(),a.completeSameEvent=r.once("blur",function(t){r.get("value")===n&&(a._makePill(e),a.input.set("value",""),a._arrangeInput())})}),e.nsid&&this.contacts.hideFromSearch(e.nsid),this.flickrShare.recipients.push(e),this.input.set("value",""),t||(this.input.focus(),a._adjustInputWidth())},_arrangeInput:function(){var e=this.input;this.get("container").one(".fake-input").insertBefore(e,this.contacts.wrapperEl),setTimeout(function(){e.focus()},10)},_onWarning:function(t,n,r){var i=e.Node.create(this.templates("fluid-warning")({message:t,title:n})),s=e.Node.create("<div></div>"),o=this.get("container"),u=20,a=this,f=o.get("clientWidth")+u,l=o.get("clientHeight")+u,c=500,h=100,p=f/2-(c+u)/2,d=l/2-(h+u)/2;i.setStyle("width",c),i.setStyle("height",h),i.setStyle("left",p),i.setStyle("top",d),s.setStyle("left",0),s.setStyle("top",0),s.setStyle("width","100%"),s.setStyle("height","100%"),s.addClass("warning-modal"),o.append(s),s.append(i),s.on("click",function(){s.remove(!0),r&&a.fire("subviewViewEvent","closeAll")})}})},"@VERSION@",{requires:["flickr-view","promise","hermes-template-fluid-share-panel","fluid-css","fluid-share-panel-css","fluid-droparound-view","hermes-template-fluid-share-embedr-code","hermes-template-fluid-share-bb-code","hermes-template-share-modal-mail-pill","hermes-template-fluid-warning","hermes-template-fluid-share-panel-error","hermes-template-fluid-share-old-html-embed-code"
,"hermes-template-fluid-share-old-iframe-embed-code","fluid-modal-view","contact-search-box","fluid-balls-css","html5-balls","overflow-helper","url-helper","storage-helper"],langBundles:["share-modal","common"]});
YUI.add("hermes-lang-share-modal",function(e,t){e.Intl.add("hermes/share-modal","en-US",{SHARE_ON_BLOGGER:["Share on Blogger"],SHARE_PHOTO:["Share Photo"],SHARE_PHOTOS:["Share photos"],PLEASE_AUTHORIZE_FLICKR_TO_POST_ON_BLOGGER:["please authorize Flickr to post on Blogger"],SHARE_ON_FACEBOOK:["Share on Facebook"],PLEASE_AUTHORIZE_FLICKR_TO_POST_ON_FACEBOOK:["please authorize Flickr to post on Facebook"],SHARE_VIA_MAIL:["Share via mail"],SHARE_ON_TUMBLR:["Share on Tumblr"],PLEASE_AUTHORIZE_FLICKR_TO_POST_ON_TUMBLR:["please authorize Flickr to post on Tumblr"],PUBLISH_NOW:["Publish now"],ADD_TO_QUEUE:["Add to queue"],SAVE_AS_DRAFT:["Save as draft"],SHARE_ON_TWITTER:["Share on Twitter"],PLEASE_AUTHORIZE_FLICKR_TO_POST_ON_TWITTER:["please authorize Flickr to post on Twitter"],SHARE_PHOTOSTREAM:["Share photostream"],SHARE_ALBUM:["Share album"],SHARE_FAVORITES:["Share favorites"],AUTHORIZE_TO_SHARE:["You need to authorize Flickr to share photos on ","${service}"],CONNECT_TO_SERVICE:["Connect to ","${service}"],OK_TAKE_ME_TO_MY_SETTINGS:["OK, take me to my settings"],POST:["Post"],SHARE:["Share"],FRIENDS:["Friends"],FAMILY:["Family"],SCREEN_NAME_OR_EMAIL:["Screen name or email"],INCLUDE_A_MESSAGE:["Include a message"],SHARE_THIS_VIA:["Share this via..."],SHARE_PREFERENCES:["share preferences"],GRAB_THE_LINK:["Grab the link"],SHOW_SHORT_URL:["show short URL"],INCLUDE_CONTENT_MARKED_AS:["Include content marked as:"],PS_ITEMS_NOT_PUBLIC:["Some of the items in your photostream aren't public."],HERE_IS_PS_LINK:["Here's a link to this photostream. Just copy and paste!"],YOU_CAN_ADD_GUEST_PASS:['You can add a Guest Pass [<a class="guest-pass-link" title="',"${title}",'" data-action="follow" href="/help/sharing/#2184">?</a>] so that recipients can view them.'],ADD_A_GUEST_PASS:["Add a guest pass"],GUEST_PASS_COPY:["Guest Passes let you share your photos that aren't public. Anyone can see your public photos anytime, whether they're a Flickr member or not. But! If you want to share photos marked as friends, family or private, use a Guest Pass. If you're sharing photos from a set, you can create a Guest Pass that includes any of your photos marked as friends, family, or private. If you're sharing your entire photostream, you can create a Guest Pass that includes photos marked as friends or family (but not your private photos)."],VISIT_GUESTPASS_HISTORY:['You can visit your <a href="/invite/history/guests/" data-action="follow">Guest Pass history</a> at any time to expire the Guest Pass.'],SOMETHING_WRONG:["Something went wrong.<br>Please refresh your browser and try again."],ERROR:["Error"],OK:["OK"],SHARE_GROUP:["Share Group"],MESSAGE:["Message"],EMAIL:["Email"],SIGN_IN_TO_EMAIL:["You must be signed in to share a photo. Sign in and try again."],LINK_ACCOUNT:["Link Account"],ACCOUNT_SETTINGS:["Account Settings"],AUTHORIZE_FLICKR:["Authorize Flickr to use your account in the Account Settings page."],COPY_TO_CLIPBOARD:["Press Ctrl+C (Win) or Command+C (Mac) to copy this link when selected"],HTML_EMBED:["HTML Embed"],SHARE_PHOTOS_TO:[{type:"plural",valueName:"count",options:{one:"Share ${#} photo to:",other:"Share ${#} photos to:"}}],SHARE_PHOTOSTREAM_TO:["Share photostream to:"],SHARE_ALBUM_TO:["Share album to:"],SHARE_FAVES_TO:["Share favorites to:"],SHARE_ALBUMS_TO:["Share albums to:"],SHARE_GROUP_TO:["Share group to:"],FACEBOOK:["Facebook"],TUMBLR:["Tumblr"],TWITTER:["Twitter"],PINTEREST:["Pinterest"],MAIL:["Mail"],EMBED:["HTML embed"],HTML:["HTML"],GRAB_LINK:["Grab link"],BBCODE:["BBCode"],VIA_FLICKR:["Via Flickr:"],SHARE_PUBLIC_ONLY:["Public photos only"],SHARE_FRIENDS:["Include photos marked Friends"],SHARE_FAMILY:["Include photos marked Family"],SHARE_FAMILY_AND_FRIENDS:["Include photos marked Family & Friends"],SHARE_FRIENDS_AND_FAMILY:["Include photos marked Friends & Family"],SHARE_PRIVATE:["All photos - public and private"],SHARING_DISABLED:["Sharing is disabled"],ON_FLICKR:["on Flickr"],PHOTO_PRIVATE_MESSAGE:['This photo is private. A guest pass [<a target="_blank" href="/help/sharing/">?</a>] will be added to allow recipients to view it.'],PHOTO_FRIENDS_MESSAGE:['This photo is only visible to friends. A guest pass [<a target="_blank" href="/help/sharing/">?</a>] will be added to allow recipients to view it.'],PHOTO_FAMILY_MESSAGE:['This photo is only visible to family. A guest pass [<a target="_blank" href="/help/sharing/">?</a>] will be added to allow recipients to view it.'],PHOTO_FAMILY_FRIENDS_MESSAGE:['This photo is only visible to friends & family. A guest pass [<a target="_blank" href="/help/sharing/">?</a>] will be added to allow recipients to view it.'],PHOTO_CAMERAROLL_MESSAGE:["All photos being shared will be viewable by the recipient(s) regardless of privacy level."],GUESTPASS_CREATION_FAILURE:["There was an error generating the share link.  Please try again."],CONTACT_SEARCH_ERROR:["There was an error when adding a recipient. Please try again."],FLICKR_SHARE_ERROR:["There was an error sharing on Flickr. Please try again."],FLICKR_SHARE_SUCCESS:["Your items have been shared!"],FLICKR_SHARE_SUCCESS_TITLE:["Success"],CLICK_GENERATE_LINK:["Click to generate a shareable link"],FLICKR_SHARE:["Share"],COPY_MAC:["Press Command+C to copy this link when selected"],COPY_PC:["Press Ctrl+C to copy this link when selected"],CANCEL_SHARE_BECAUSE_ERROR:[{type:"plural",valueName:"photoCount",options:{one:"This photo cannot be shared. Please try again later.",other:"These photos cannot be shared. Please try again later."}}],LINK_PRIVACY_REMINDER:[{type:"plural",valueName:"photoCount",options:{one:"The private photo in this selection will remain private. Only people you share this link with will be able to view it.",other:"The private photos in this selection will remain private. Only people you share this link with will be able to view them."}}],PHOTO_PAGE_PRIVACY_WARNING:["This photo will remain private. Only people you share this link with will be able to view it."],CAMERAROLL_PRIVACY_WARNING:[{type
:"plural",valueName:"photoCount",options:{one:"This photo will remain private. Only people you share this link with will be able to view it.",other:"Any private photos in this selection will remain private. Only people you share this link with will be able to view them."}}],ALBUM_PRIVACY_WARNING:[{type:"plural",valueName:"photoCount",options:{one:"The private photo in this album will remain private. Only people you share this link with will be able to view it.",other:"Any private photos in this album will remain private. Only people you share this link with will be able to view them."}}],PHOTOSTREAM_PRIVACY_WARNING:[{type:"plural",valueName:"photoCount",options:{one:"The private photo in your photostream will remain private. Only people you share this link with will be able to view it.",other:"Any private photos in your photostream will remain private. Only people you share this link with will be able to view them."}}],CANCEL_SHARE_BECAUSE_RESTRICTED:["Sorry! You can't share restricted photos."],NO_SHAREABLE_ITEMS:["There are no items available to share."]})},"@VERSION@",{requires:["intl"]});
YUI.add("fluid-share-view",function(e,t){var n="signedOutEmailSharing",r={shareRedirectURL:e.url("/window_close.html"),css:{shareBtn:"fluid-share-button",networkClasses:{twitter:{canShare:!1,className:"twitter-link",serviceId:9},facebook:{canShare:!1,className:"facebook-link",serviceId:128},tumblr:{canShare:!1,className:"tumblr-link",serviceId:12},pinterest:{canShare:!1,className:"pinterest-link",serviceId:132},flickr:{canShare:!1,className:"flickr-link",serviceId:130}}}};r.networks={facebook:{clientId:e.config.flickr.facebook.client_id,shareUrl:"https://www.facebook.com/dialog/share?app_id="+e.config.flickr.facebook.client_id+"&display=popup&redirect_uri="+encodeURIComponent(r.shareRedirectURL)+"&href="},twitter:{shareUrl:"https://twitter.com/intent/tweet?text={{tweetText}}&url={{linkToShare}}",hashTags:"#flickr"},tumblr:{shareUrl:"https://www.tumblr.com/widgets/share/tool?shareSource=legacy&content={{displayPhotoURL}}&caption={{tumblrCaption}}&tags={{tags}}&posttype=photo&clickthroughUrl={{linkToShare}}"},pinterest:{shareUrl:"https://pinterest.com/pin/create/bookmarklet/?media={{displayPhotoURL}}&url={{linkToShare}}&description={{description}}"},googlePlus:{shareUrl:"https://plus.google.com/share?url="},flickr:{apiCall:"flickr.sharing.post"}},"use strict",e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this.extraModalClasses=this.extraModalClasses||"",this.appContext.lang.toLowerCase()==="en-us"?this.isEnglishLang=!0:this.isEnglishLang=!1,this},loadState:function(){return e.Promise.resolve()},buildContainer:function(e){return e=e||{},this.setContainerHTML(this.templates("fluid-share")(e)),this},activate:function(){var t=this.get("container"),n="."+r.css.shareBtn,i=t.one(n);return i&&(this.isEnglish||!this.isDisabled)&&this.registerEventHandler(t.delegate("click",function(t){t.preventDefault(),this.getItemCount().then(function(t){e.rapidTracker.beacon(this.subClassName,"shareButtonClick",{count:t})}.bind(this)),this.prepareModal(i)},n,this)),this},prepareModal:function(e){this.shouldCancelModal()||this.getItemCount().then(function(t){this.isDisabled?this.showErrorModal():this.showModal(e,t)}.bind(this))},showModal:function(t,i){var s=this,o=this.getIsMine(),u=r.css.networkClasses,a=s.getTitleIntlKey(),f={intlName:"share-modal."+a},l;a==="SHARE_PHOTOS_TO"&&(f.count=i),l=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,noScroll:!0,hideModalOverlay:!1,maxHeight:!1,showFooter:!1,title:s.intlMessage(f),classList:"modal-restyle "+s.extraModalClasses,width:560,subview:new e.Views["fluid-share-panel-view"]({appContext:s.appContext,networkClasses:u,linkShareParams:this.prepareLinkShareParameters(),guestPassParams:this.getGuestPassParams(),emailShareParams:this.prepareFlickrShareParameters(),isMine:o,shareItemCount:i,signedOutSharingPerms:this.getSignedOutSharingPerms()})}),l.registerEventHandler(l.get("container").delegate("click",function(e){e.preventDefault(),e.target.ancestor("."+u.facebook.className,!0)?s.preProcessShare(s.prepareFacebookShareParameters,s.shareToFacebook):e.target.ancestor("."+u.twitter.className,!0)?s.preProcessShare(s.prepareTwitterShareParameters,s.shareToTwitter):e.target.ancestor("."+u.tumblr.className,!0)?s.preProcessShare(s.prepareTumblrShareParameters,s.shareToTumblr):e.target.ancestor("."+u.pinterest.className,!0)&&s.preProcessShare(s.preparePinterestShareParameters,s.shareToPinterest)},".share-link.sharing-type-enabled")),l.on("share-by-email",function(t){var n=e.merge(s.prepareFlickrShareParameters(),t);s.shareToFlickr(l,n)}),l.on("done-sharing",function(t){l.close(),s.guestPassURLs={},e.rapidTracker.beacon(this.subClassName,"doneSharingClick")}),l.on("request-guestpass",function(e,t,n){s.requestGuestpass(l,t,n,!0)}),l.on("generate-link",function(){s.generateLink().then(function(e){l.fire("parentViewEvent","generated-link",e)})}),l.on("activated",function(){l.get("subview").cancel&&l.get("container").one(".title").setHTML(s.intlMessage({intlName:"common.OOPS"})),l.reposition()}),l.on("guestpass-required",function(){s.guestpassRequired=!0}),l.on("confirm-sign-out",function(){l.close();var t=new e.Views.FluidModal({appContext:s.appContext,title:s.intlMessage({intlName:"common.OOPS"}),message:s.intlMessage({intlName:"share-modal.SIGN_IN_TO_EMAIL"}),actionButtonLabel:s.intlMessage({intlName:"common.OK"}),classList:"sharing-sign-out-modal",showCancelButton:!0});t.on("actionClick",function(){e.StorageHelper.setItem(n,new Date),e.SigninHelper.addPendingShare({shareType:"email"})}),setTimeout(function(){t.show()},10)}),l.on("close",function(){s.fire("sharePresentationClose"),s.guestPassURLs={}}),l.on("closeAll",function(){s.fire("sharePresentationClose"),l.close(),s.guestPassURLs={}}),l.show(),this.sharePresentation=l},showErrorModal:function(){var t=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,showCancelButton:!1,noScroll:!0,hideModalOverlay:!1,showFooter:!0,title:this.intlMessage({intlName:"common.OOPS"}),message:this.intlMessage({intlName:"share-modal.NO_SHAREABLE_ITEMS"})});t.show()},prepareFacebookShareParameters:function(){return{url:"",count:1}},prepareTwitterShareParameters:function(){return{shortURL:"",url:"",title:"",count:1}},prepareTumblrShareParameters:function(){return{title:"",authorURL:"",ownerName:"",description:"",displayPhotoURL:"",url:"",count:1}},preparePinterestShareParameters:function(){return{title:"",description:"",displayPhotoURL:"",shortURL:"",url:"",count:1}},prepareGooglePlusShareParameters:function(){return{url:"",count:1}},prepareFlickrShareParameters:function(){return{modelName:"",modelId:"",title:"",url:"",count:1}},prepareLinkShareParameters:function(){return{sizes:{},url:"",title:"",author:"",authorURL:"",shortURL:"",supportsEmbedr:!1,supportsBBCode:!1,privacyWarningString:"",generateLink:!1}},getTitleIntlKey:function(){return"SHARE_PHOTOS_TO"},getItemCount
:function(){return e.Promise.resolve(1)},getIsMine:function(){return!1},getGuestPassParams:function(){return{type:null,id:null,contentMarkedFriends:!0,contentMarkedFamily:!0,contentMarkedFriendFamily:!0,contentMarkedPublic:!0,canSharePrivate:!1,sharingEntirelyNotPublic:!1,multipleItems:!1,nonPublicWarning:null,shareToAll:!1,showGuestPassDropdown:!1,shareToSpecific:null}},getSignedOutSharingPerms:function(){return{facebook:{canShare:!1},twitter:{canShare:!1},tumblr:{canShare:!1},pinterest:{canShare:!1},flickr:{canShare:!1}}},shouldCancelModal:function(){return!1},shareToFacebook:function(t,n){if(!t.url)return e.Flog.error("[fluid-share-view] Error sharing to Facebook.  Missing url.");var i,s=encodeURIComponent(e.url(t.url)),o=this.guestPassURLs,u,a,f,l;this.guestpassRequired&&o&&(u=o[100],a=o["010"],f=o[110],l=o[111],a&&(s=a),u&&(s=u),f&&(s=f),l&&(s=l)),i=r.networks.facebook.shareUrl+s,e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"facebook",count:t.count||1}),n?n.location.replace(i):n=this.createSharePopup(i),this.trackShareCompletion(n)},shareToTwitter:function(t,n){if(typeof t.url=="undefined"||t.url===null)return e.Flog.error("[fluid-share-view] Error sharing to Twitter.  Missing url.");if(!t.title)return e.Flog.error("[fluid-share-view] Error sharing to Twitter.  Missing title.");var i,s,o=t.title,u,a;s=t.url===""?"":encodeURIComponent(t.url),a=o+" "+r.networks.twitter.hashTags,a.length+s.length>140&&(u=a.length+s.length-140,a=o.substring(0,o.length-(u+1))+"\u2026"+" "+r.networks.twitter.hashTags),i=r.networks.twitter.shareUrl.replace("{{tweetText}}",encodeURIComponent(a)).replace("{{linkToShare}}",s),n?n.location.replace(i):n=this.createSharePopup(i),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"twitter",count:t.count||1}),this.trackShareCompletion(n)},shareToTumblr:function(t,n){if(!t.title)return e.Flog.error("[fluid-share-view] Error sharing to Tumblr.  Missing title.");if(!t.displayPhotoURL)return e.Flog.error("[fluid-share-view] Error sharing to Tumblr.  Missing displayPhotoURL.");var i,s=t.title,o,u,a=t.tags||"",f=t.description,l,c=e.URLHelper.addProtocolToURL(t.displayPhotoURL),h,p=t.isPhotoPage,d=r.networks.tumblr.shareUrl;!p||this.appContext.flipper.isFlipped("enable-flickr-embeds-on-tumblr")?d+="&url={{linkToShare}}":d+="&href={{linkToShare}}",t.authorURL&&(o=e.url(t.authorURL)),t.ownerName&&(u=t.ownerName),t.url.indexOf("https://")===0?l=t.url:t.url.indexOf("//")===0?l=e.URLHelper.addProtocolToURL(t.url):l=e.url(t.url),i=this.templates("fluid-share-tumblr-post")({title:s,ownerURL:o,ownerName:u,description:f,linkToShare:l}),h=d.replace("{{displayPhotoURL}}",encodeURIComponent(c)).replace("{{tumblrCaption}}",encodeURIComponent(i)).replace(/{{linkToShare}}/g,encodeURIComponent(l)).replace("{{tags}}",encodeURIComponent(a)),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"tumblr",count:t.count||1}),n?n.location.replace(h):n=this.createSharePopup(h,!0)},shareToPinterest:function(t,n){if(!t.title)return e.Flog.error("[fluid-share-view] Error sharing to Pinterest.  Missing title.");if(!t.displayPhotoURL)return e.Flog.error("[fluid-share-view] Error sharing to Pinterest.  Missing displayPhotoURL.");if(!t.url)return e.Flog.error("[fluid-share-view] Error sharing to Pinterest.  Missing url.");if(!t.shortURL)return e.Flog.error("[fluid-share-view] Error sharing to Pinterest.  Missing shortURL.");var i,s,o=t.description||"",u=t.shortURL,a=t.title,f=e.URLHelper.addProtocolToURL(t.displayPhotoURL),l;s=encodeURIComponent(e.url(t.url)),o.trim()!==""?l=u+" | "+a+" | "+o:l=u+" | "+a,f=f.replace("https:","http:"),s=s.replace("https:","http:"),i=r.networks.pinterest.shareUrl.replace("{{displayPhotoURL}}",encodeURIComponent(f)).replace("{{description}}",encodeURIComponent(l)).replace("{{linkToShare}}",s),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"pinterest",count:t.count||1}),n?n.location.replace(i):n=this.createSharePopup(i,!0)},shareToGooglePlus:function(t,n){if(!t.url)return e.Flog.error("[fluid-share-view] Error sharing to GooglePlus.  Missing url.");var i,s;s=encodeURIComponent(e.url(t.url)),i=r.networks.googlePlus.shareUrl+s,e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"googlePlus",count:t.count||1}),n?n.location.replace(i):n=this.createSharePopup(i)},shareToFlickr:function(t,i){if(!i.recipients)return e.Flog.error("[fluid-share-view] Error sharing to Flickr.  Missing recipients.");if(!i.message)return e.Flog.error("[fluid-share-view] Error sharing to Flickr.  Missing message.");if(!i.url)return e.Flog.error("[fluid-share-view] Error sharing to Flickr.  Missing url.");if(!i.modelName)return e.Flog.error("[fluid-share-view] Error sharing to Flickr.  Missing modelName.");if(!i.modelId)return e.Flog.error("[fluid-share-view] Error sharing to Flickr.  Missing modelId.");var s,o=i.modelName,u=i.modelId,a=i.recipients,f=i.message,l=i.guestpassStr||"public",c={},h=[],p=[],d,v;s=encodeURIComponent(e.url(i.url)),o==="share_code"?c[o]=u:c[o+"_id"]=u,c.service_type_id="130",c.owner_id=this.appContext.getViewer().nsid;if(l!=="public"){if(l==="friends"||l==="family_and_friends")c.guestpass_friends="1";if(l==="family"||l==="family_and_friends")c.guestpass_family="1";l==="private"&&(c.guestpass_private="1")}for(d in a)v=a[d]||{},v.email?h.push(v.email):v.nsid&&p.push(v.nsid);c.to_flickr=p.join(","),c.to_email=h.join(","),c.message=e.flutil.escapeInput(f),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"flickr",count:i.count||1});var m=e.StorageHelper.getItem(n);if(m){var g;try{g=e.moment(m),g.isValid()&&(new e.moment).diff(g,"hours")<2&&(e.rapidTracker.beacon(this.get("parentViewName"),"signedOutEmailShare",{count:i.count||1}),e.StorageHelper.remove(n))}catch(y){}}this.appContext.callAPI(r.networks.flickr.apiCall,c).then(function(){t&&t.fire("parentViewEvent","flickr-share-success")},function(e){t&&t.fire("parentViewEvent","flickr-share-error"
)})},generateLink:function(){var t=this;return this.onBeforeShare().then(function(e){return e},function(n){t.sharePresentation.fire("closeAll"),setTimeout(function(){var n=new e.Views.FluidModal({appContext:t.appContext,title:t.intlMessage({intlName:"common.OOPS"}),message:t.intlMessage({intlName:"share-modal.CANCEL_SHARE_BECAUSE_ERROR",photoCount:t.getGuestPassParams.multipleItems?10:1}),actionButtonLabel:t.intlMessage({intlName:"common.OK"}),classList:"sharing-failure-modal",showCancelButton:!1});n.show()},10)})},preProcessShare:function(t,n){var r=this;if(this.onBeforeShare){var i=this.createSharePopup("",!0);try{i.document.body.innerHTML=r.templates("fluid-share-loading-state")()}catch(s){s.code===18&&(i.close(),i=this.createSharePopup("",!0),i.document.body.innerHTML=r.templates("fluid-share-loading-state")())}this.onBeforeShare().then(function(s){var o;try{o=t.call(r)}catch(u){e.Flog.error("[fluid-share-view] Error getting share parameters:",u)}n.call(r,o,i)})}else{var o;try{o=t.call(r)}catch(s){e.Flog.error("[fluid-share-view] Error getting share parameters:",s)}n.call(r,o)}},trackShareCompletion:function(t){var n=function(r){if(r.source===t)if(r.origin===e.url("/")&&r.data==="Window closed")e.Flog.log("[fluid-share-view] Closing Facebook window."),e.rapidTracker.beacon(this.get("parentViewName"),"photoSharedToFacebook"),e.config.win.removeEventListener("message",n,!1);else if(r.origin===e.url("/")&&r.data.indexOf("share failure")===0)e.Flog.error("[fluid-share-view] Got Facebook error:",r.data),e.config.win.removeEventListener("message",n,!1);else if(r.origin==="https://twitter.com"&&r.data!=="__ready__")try{e.Flog.warn("[fluid-share-view] Tracking share completion:",r.data),JSON.parse(r.data).params[0]==="tweet"&&r.returnValue&&(e.rapidTracker.beacon(this.get("parentViewName"),"photoSharedToTwitter"),e.config.win.removeEventListener("message",n,!1))}catch(i){e.Flog.warn("[fluid-share-view] Error tracking share completion:",i)}};e.config.win.addEventListener("message",n,!1)},createSharePopup:function(t,n){var r={},i="",s="nativeShare"+(new Date).getTime();return r.width=n?950:640,r.height=480,r.top=(e.config.win.screen.height-r.height)/2,r.left=(e.config.win.screen.width-r.width)/2,e.Object.each(r,function(e,t){i+=t+"="+e+","}),i=i.slice(0,-1),e.config.win.open(t,s,i)},requestGuestpass:function(e,t,n,r){var i=this;this.guestPassURLs||(this.guestPassURLs={});if(this.guestPassURLs[t]){e.fire("parentViewEvent","guestpass-created",t,this.guestPassURLs[t]);return}this.appContext.callAPI("flickr.sharing.createGuestpass",n).then(function(n){if(!n||!n.guestpass||!n.guestpass.url)throw new Error("No guestpass returned");i.guestPassURLs[t]=n.guestpass.url,e.fire("parentViewEvent","guestpass-created",t,i.guestPassURLs[t])},function(s){r?i.requestGuestpass(e,t,n):e.fire("parentViewEvent","guestpass-failed",s)})}},{ATTRS:{parentViewName:{value:""}}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-css","fluid-modal-view","hermes-template-fluid-share","hermes-template-fluid-share-tumblr-post","hermes-template-fluid-share-loading-state","fluid-share-panel-view","flog","url","flutil","url-helper","signin-helper"],optionalRequires:["fluid"],langBundles:["share-modal","common"]});
YUI.add("fluid-share-photo-view",function(e,t){e.FlickrView.create(this.name,e.namespace("Views")["fluid-share-view"],[],{langBundles:this.details.langBundles,subClassName:t,initializer:function(e){return this.nsid=e.nsid,this.photoId=e.photoId,this.constructor.superclass.initializer.call(this,e)},loadState:function(){var t=this;return e.Promise.all([this.appContext.getModel("photo-models",this.photoId),this.appContext.getModel("photo-privacy-models",this.photoId),this.appContext.getModel("photo-engagement-models",this.photoId),this.appContext.getModel("photo-tags-models",this.photoId)]).then(function(e){t.set("photoModel",e[0]),t.set("privacyModel",e[1]),t.set("engagementModel",e[2]),t.set("photoTagsModels",e[3]),t.set("tags",t.get("photoTagsModels").getValue("tags").toJSON())})},buildContainer:function(){var e=this.get("photoModel").getValue("safetyLevel")===2;return this.get("photoModel").getValue("owner").id!==this.appContext.getViewer().nsid&&(e=e||!this.get("privacyModel").getValue("isPublic")),this.constructor.superclass.buildContainer.call(this,{extraShareButtonIconClassList:"share-photo-icon",showShareButtonLabel:!1,sharingDisabled:e,shareTooltip:this.intlMessage({intlName:"share-modal.SHARE_PHOTO"})}),this},prepareFacebookShareParameters:function(){return{url:this.get("photoModel").getValue("url")}},prepareTwitterShareParameters:function(){var t=this.get("photoModel");return{url:e.URLHelper.getShortURL(t.getValue("id")),title:t.getValue("title")||this.intlMessage({intlName:"default.UNTITLED"})}},prepareTumblrShareParameters:function(){var e=this.get("photoModel"),t=e.getValue("owner"),n=e.getLargestSize({excludeSizes:["o"]}).url,r=this.appContext.flipper.isFlipped("enable-flickr-embeds-on-tumblr");return{title:e.getValue("title")||this.intlMessage({intlName:"default.UNTITLED"}),authorURL:t.getValue("url"),ownerName:t.getValue("displayname"),description:e.getValue("description"),displayPhotoURL:r?e.getValue("url"):n,url:e.getValue("url"),isPhotoPage:!0,tags:this.get("tags").map(function(e){return e.tagRaw}).join(",")}},preparePinterestShareParameters:function(){var t=this.get("photoModel");return{title:t.getValue("title")||this.intlMessage({intlName:"default.UNTITLED"}),description:t.getValue("description"),displayPhotoURL:t.getLargestSize({excludeSizes:["o"]}).url,shortURL:e.URLHelper.getShortURL(t.getValue("id")),url:t.getValue("url"),count:1}},prepareFlickrShareParameters:function(){var e=this.get("photoModel");return{title:e.getValue("title")||this.intlMessage({intlName:"default.UNTITLED"}),modelName:"photo",modelId:e.getValue("id"),url:e.getValue("url"),count:1}},prepareLinkShareParameters:function(){var t=this.get("photoModel"),n=this.get("engagementModel").getValue("canShare");return{url:t.getValue("url"),author:t.getValue("owner").getValue("displayname"),authorURL:t.getValue("owner").getValue("url"),shortURL:e.URLHelper.getShortURL(t.getValue("id")),supportsEmbedr:n,supportsBBCode:n,sizes:t.getValue("sizes"),title:t.getValue("title")||this.intlMessage({intlName:"default.UNTITLED"}),privacyWarningString:this.intlMessage({intlName:"share-modal.PHOTO_PAGE_PRIVACY_WARNING"})}},getTitleIntlKey:function(){return"SHARE_PHOTOS_TO"},getGuestPassParams:function(){var e=this.get("privacyModel"),t=e.getValue("isVisibleByFriends"),n=e.getValue("isVisibleByFamily"),r=!e.getValue("isPublic"),i=this.get("photoModel"),s=i.getValue("isOwner"),o;return n&t?o=this.intlMessage({intlName:"share-modal.PHOTO_FAMILY_FRIENDS_MESSAGE"}):n?o=this.intlMessage({intlName:"share-modal.PHOTO_FAMILY_MESSAGE"}):t?o=this.intlMessage({intlName:"share-modal.PHOTO_FRIENDS_MESSAGE"}):r&&(o=this.intlMessage({intlName:"share-modal.PHOTO_PRIVATE_MESSAGE"})),{type:"photo",id:this.photoId,contentMarkedFriends:s&&t&&!n,contentMarkedFamily:s&&n&&!t,contentMarkedFriendFamily:s&&n&&t,contentMarkedPublic:!r&&!n&&!t,canSharePrivate:s&&r&&!n&&!t,showGuestPassDropdown:s&&r,multipleItems:!1,sharingEntirelyNotPublic:s&&r,nonPublicWarning:o}},getIsMine:function(){return this.get("photoModel").getValue("isOwner")},getSignedOutSharingPerms:function(){var e=this.get("engagementModel").getValue("canShare");return{facebook:{canShare:e},twitter:{canShare:e},tumblr:{canShare:e},pinterest:{canShare:e},flickr:{canShare:e}}},onParentViewEvent:function(e,t){(t[0]==="enable-sharing"||t[0]==="disable-sharing")&&this.buildContainer()},shouldCancelModal:function(){var e=this.get("photoModel").getValue("safetyLevel")===2;return e&&this.buildContainer(),e}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-share-view","url-helper"],langBundles:["models","default","share-modal"]});
YUI.add("hermes-lang-default",function(e,t){e.Intl.add("hermes/default","en-US",{UNTITLED:["Untitled"]})},"@VERSION@",{requires:["intl"]});
YUI.add("products-api-helper",function(e){function s(e,t,n,r){var i,s,o,u,a,f,l,c,h,p;if(t&&!t.isValidCoupon)throw h=new Error(t.invalidReason),h.name="CouponInvalidError",h;return i=r.couponRegistry,s=r.discountRegistry,a=[],e.id=e.couponId,f=e.discounts.discount[0],p=f.discountId,c={costDiscount:f.costDiscount,couponId:e.id,discountType:f.discountType,discountValue:f.discountValue,minPurchaseValue:f.minPurchaseValue,productEntity:f.productEntity},s.exists(p)?(s.setValues(p,c),l=s.proxy(p)):(c.id=p,l=s.add(c)),a.push(l),o={code:e.code,orderId:n,discounts:a},t&&(o.isSingleUse=t.isSingleUse,o.isUserSpecific=t.isUserSpecific,o.isValidCoupon=t.isValidCoupon),i.exists(e.id)?(i.setValues(e.id,o),u=i.proxy(e.id)):(o.id=e.id,u=i.add(o)),u}function o(e,t,n){var r,i,s;return r=n.orderItemRegistry,i=n.itemPriceRegistry,e instanceof Array&&(e=e[0]),e=e.map(function(e){var n=e.renderedProductId,o,u,a,f,l={};return l.sourceProductId=e.sourceProductId,l.productType=e.productType,l.productTitle=e.productTitle,l.quantity=e.quantity,l.cost=e.costProductUnit,l.orderId=t,e.productPrice&&(a=e.productPrice,s={priceBase:a.priceBase,countPagesBase:a.countPagesBase,countPagesExtra:a.countPagesExtra,pricePerPage:a.pricePerPage,pricePagesExtra:a.pricePagesExtra,priceTotal:a.priceTotal},a.shipping&&(f=a.shipping,f.standardShipping&&(s.standardShippingBase=f.standardShipping.priceShippingBase,s.standardShippingExtra=f.standardShipping.priceShippingExtra),f.expressShipping&&(s.expressShippingBase=f.expressShipping.priceShippingBase,s.expressShippingExtra=f.expressShipping.priceShippingExtra)),i.exists(n)?(o=i.proxy(n),o.setValues(s)):(s.id=n,o=i.add(s))),e.product&&e.product.skuId&&(l.skuId=e.product.skuId),l.price=o,r.exists(n)?(u=r.proxy(n),u.setValues(l),u):(l.id=n,r.add(l))}),e}function u(e,t){var n,r,i,s,o;o={},n=t.orderRegistry,e.orderId&&(e.id=e.orderId);if(e.couponMetadata&&!e.couponMetadata.isValidCoupon)throw s=new Error(e.couponMetadata.invalidReason),s.name="CouponInvalidError",s;return e.coupons&&(o.coupon=this.parseCoupons(e.coupons.coupon,e.couponMetadata,e.orderId,t),i=o.coupon.getValue("discounts").getList()[0],i&&i.getValue("discountType")==="percent"&&parseInt(i.getValue("discountValue"),10)===100?o.isFreeOrder=1:o.isFreeOrder=0),e.item&&(o.items=this.parseItems(e.item,e.id,t)),o.orderId=e.orderId,o.statusOrder=e.statusOrder,o.statusPrint=e.statusPrint,o.statusPayment=e.statusPayment,o.paymentMethodId=e.paymentMethodId,o.bookPreviewPdf=e.bookPreviewPdf,o.userId=e.userId,o.trackingNum=e.trackingNum,o.trackingUrl=e.trackingUrl,o.costTotal=parseFloat(e.costTotal)||0,o.costProducts=parseFloat(e.costProducts)||0,o.costShipping=e.costShipping||0,o.costDiscount=e.costDiscount||0,o.costTax=e.costTax,o.isCouponApplied=e.isCouponApplied,o.shippingType=e.shippingType||e.shipMethod||"standard_shipping",o.dateCreate=e.dateCreate,e.countryCode&&(o.countryCode=e.countryCode),n.exists(e.orderId)?(r=n.proxy(e.orderId),r.setValues(o),r):(o.id=e.orderId,n.add(o))}function a(t,n){var r=t,i=n.pageModelRegistry,s=n.bookModelRegistry,o=n.pagePhotoModelRegistry,u=n.photoModelRegistry,a=n.personRegistry,f=n.photoEngagementRegistry,l=n.photoStatsRegistry,c,h=[];if(r)return t={id:r.id,owner:r.owner,title:r.title,coverPhotoId:r.coverPageId,totalPhotos:0,price:r.price,created:r.dateCreate},r.page&&e.Array(r.page).forEach(function(n){var r=[],s;n.photo&&e.Array(n.photo).forEach(function(i){var s,h,p;e.Lang.isNumber(parseInt(i.id,10))&&(n.id=String(n.id).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),p=n.id+"_"+i.position,s={id:p,bookId:t.id,position:i.position,cropX:i.cropX/100,cropY:i.cropY/100,cropW:i.cropW/100,cropH:i.cropH/100,invalidForPrintReason:i.invalidForPrintReason,isInvalidForPrint:i.isInvalidForPrint},h=e.APIHelper.response.parsePhotos({photos:[i],personModelRegistry:a,photoModelRegistry:u,photoEngagementModelRegistry:f,photoStatsModelRegistry:l})[0],s.photo=h,c=s.id,o.exists(c)?(delete s.id,o.setValues(c,s)):o.add(s),r.push(o.proxy(c)))}),s=e.APIHelper.response.parsePage(n),s.bookId=t.id,s.pagePhotos=r,c=s.id,i.exists(c)?(delete s.id,i.setValues(c,s),n=i.proxy(c)):n=i.add(s),h.push(c),t.totalPhotos=t.totalPhotos+r.length,t.coverPage||(t.coverPage=n)}),t.pageOrder=h,s.exists(t.id)?s.setValues(t.id,{title:t.title,pageOrder:t.pageOrder,totalPhotos:t.totalPhotos,coverPage:t.coverPage}):s.add(t),t}var t,n,r,i;t={1:"Flickr Pro",2:"Flickr Pro",3:"Flickr Pro",4:"Ad Free",6:"Ad Free"},n={1:"3 months",2:"1 year",3:"2 years",4:"1 year",6:"1 month"},r={1:"Created",2:"Pending",3:"Submitted",4:"Accepted",5:"Packaged",6:"Shipped",7:"Voided",99:"Cancelled",101:"Submitted"},i={initiated:1,active:2,closed:3,canceled:4,failed:5,refunded:6,pending:7,subscription_canceled:8,subscription_charged_successfully:9,subscription_charged_unsuccessfully:10,subscription_expired:11,subscription_went_past_due:12,change_initiated:13,closed_pending:14},e.ProductsAPIHelper={parseOrder:u,parseCoupons:s,parseItems:o,parseBook:a}},"@VERSION@",{requires:[]});
YUI.add("flickr-products-books-editPage-updater",function(e,t){"use strict";function n(n,r){var i={};return i.page_id=n.pageId,i.book_id=n.bookId,n.templateId&&(i.template_id=n.templateId),n.backgroundColor&&(i.background_color=n.backgroundColor),r.callAPI("flickr.products.books.editPage",i).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-products-books-editPage"]={run:n}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("flickr-products-books-getPage-fetcher",function(e,t){"use strict";function n(t){var n={extras:e.APIHelper.request.getRebootPhotoExtras(),book_id:t.bookId,page_id:t.id};return t.page=t.page||1,t.perPage=t.perPage||100,n}function r(e,t){var n=e[0],r=e[1],i={id:t.id,photo:[]},s=[],o=!1,u=!1;r.exists(t.id)&&(s=r.getValue(t.id,"photoList").getList(),o=s.hasMinBoundary?s.hasMinBoundary():!1,u=s.hasMaxBoundary?s.hasMaxBoundary():!1),i.pageNumber=n.pageNumber,i.template=parseInt(n.template,10),i.countPhotos=n.countPhotos,i.photo=n.photo,i.backgroundColor=n.backgroundColor,r.exists(t.id)?r.setValue(t.id,"photoList",i.photoList):r.add(i)}function i(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.products.books.getPage",this._processParams(n)),r.getModelRegistry("page-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-products-books-getPage"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models"]});
